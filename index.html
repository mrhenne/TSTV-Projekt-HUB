<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testsieger-TV | Pro Hub</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        deepBlue: '#0A0F1C',
                        slateGray: '#1E293B',
                        cyanAccent: '#06B6D4',
                        purpleAccent: '#8B5CF6'
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: #475569; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #06B6D4; }
        
        .glass-panel {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .dark .glass-panel {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .glow-focus:focus {
            box-shadow: 0 0 15px rgba(6, 182, 212, 0.5);
            border-color: #06B6D4;
            outline: none;
        }

        .dragging {
            opacity: 0.5;
            transform: scale(0.98);
        }
    </style>
</head>
<body class="bg-slate-50 dark:bg-deepBlue text-slate-900 dark:text-slate-100 transition-colors duration-300 overflow-hidden">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- ICONS ---
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>;
        const IconGrip = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="cursor-grab active:cursor-grabbing text-slate-400"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>;
        const IconList = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>;
        const IconData = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const IconCompare = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><path d="M13 6h3a2 2 0 0 1 2 2v7"></path><line x1="6" y1="9" x2="6" y2="21"></line></svg>;
        const IconZap = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;

        // --- CONFIG & TEMPLATES ---
        const CATEGORIES = [
            { id: 'saugroboter', name: 'Saugroboter' },
            { id: 'wischsauger', name: 'Wischsauger' },
            { id: 'audio', name: 'Audio & HiFi' },
            { id: 'smartphone', name: 'Smartphone' }
        ];

        const DEFAULT_CHECKLISTS = {
            saugroboter: [
                { id: 'c1', text: 'Unboxing & Lieferumfang prüfen', done: false },
                { id: 'c2', text: 'App-Setup & Kartierung (Erster Run)', done: false },
                { id: 'c3', text: 'Navigationstest (Stuhlbeine, Kabel, Teppichkanten)', done: false },
                { id: 'c4', text: 'Saugleistung Hartboden (Krümel, Haare, Staub)', done: false },
                { id: 'c5', text: 'Saugleistung Teppich (Tiefenreinigung)', done: false },
                { id: 'c6', text: 'Wischfunktion (Eingetrocknete Flecken)', done: false },
                { id: 'c7', text: 'Stationstest (Absaugung, Moppwäsche, Trocknung)', done: false },
                { id: 'c8', text: 'Wartung & Reinigung der Bürsten', done: false }
            ],
            wischsauger: [
                { id: 'w1', text: 'Zusammenbau & Verarbeitung prüfen', done: false },
                { id: 'w2', text: 'Wassertanks füllen (Handling)', done: false },
                { id: 'w3', text: 'Reinigungsleistung Hartboden leicht', done: false },
                { id: 'w4', text: 'Reinigungsleistung Extrem (Ketchup, Müsli)', done: false },
                { id: 'w5', text: 'Kantenreinigung (Wie nah kommt er an die Leiste?)', done: false },
                { id: 'w6', text: 'Selbstreinigungsfunktion der Station testen', done: false },
                { id: 'w7', text: 'Geruchsentwicklung nach 3 Tagen prüfen', done: false }
            ],
            audio: [
                { id: 'a1', text: 'Verarbeitung & Tragekomfort bewerten', done: false },
                { id: 'a2', text: 'ANC Test (Büro, Straße, Zug simuliert)', done: false },
                { id: 'a3', text: 'Klangprofil Analyse (Bass, Mitten, Höhen)', done: false },
                { id: 'a4', text: 'Mikrofonqualität bei Anrufen testen', done: false },
                { id: 'a5', text: 'Akkulaufzeit Praxistest', done: false }
            ],
            smartphone: [
                { id: 's1', text: 'Display Helligkeit & Farben im Freien', done: false },
                { id: 's2', text: 'Kamera Setup (Tag, Nacht, Ultraweit)', done: false },
                { id: 's3', text: 'Performance (Gaming, Multitasking)', done: false },
                { id: 's4', text: 'Akkulaufzeit (Screen-On-Time messen)', done: false },
                { id: 's5', text: 'Ladegeschwindigkeit messen', done: false }
            ]
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);

        // --- COMPONENTS ---

        const App = () => {
            // State
            const [projects, setProjects] = useState(() => JSON.parse(localStorage.getItem('ttv_projects')) || []);
            const [currentProjectId, setCurrentProjectId] = useState(null);
            const [activeTab, setActiveTab] = useState('checklist'); // checklist, data, compare, ai
            
            const [isGenerating, setIsGenerating] = useState(false);
            const [aiError, setAiError] = useState('');

            // UI Modal States
            const [showNewProjectModal, setShowNewProjectModal] = useState(false);
            const [newProjectTitle, setNewProjectTitle] = useState('');
            const [newProjectCategory, setNewProjectCategory] = useState('saugroboter');
            const [projectToDelete, setProjectToDelete] = useState(null);

            // Inline Input States
            const [newChecklistText, setNewChecklistText] = useState('');
            const [newSpecKey, setNewSpecKey] = useState('');

            // Persist Data
            useEffect(() => {
                localStorage.setItem('ttv_projects', JSON.stringify(projects));
            }, [projects]);

            const currentProject = projects.find(p => p.id === currentProjectId);

            // Project Management
            const handleCreateProject = () => {
                if (!newProjectTitle.trim()) return;
                const cat = newProjectCategory;

                const newProject = {
                    id: generateId(),
                    title: newProjectTitle,
                    category: cat,
                    createdAt: new Date().toISOString(),
                    checklist: [...(DEFAULT_CHECKLISTS[cat] || [])].map(item => ({...item, id: generateId()})),
                    data: { note: '', pros: '', cons: '', notes: '' },
                    comparison: {
                        model: newProjectTitle,
                        predecessor: '',
                        competitor: '',
                        specs: [
                            { id: generateId(), key: 'Preis (UVP)', current: '', pred: '', comp: '' },
                            { id: generateId(), key: 'Besonderheit', current: '', pred: '', comp: '' }
                        ]
                    },
                    aiDraft: ''
                };
                
                setProjects([...projects, newProject]);
                setCurrentProjectId(newProject.id);
                setActiveTab('checklist');
                setShowNewProjectModal(false);
                setNewProjectTitle('');
                setNewProjectCategory('saugroboter');
            };

            const confirmDeleteProject = () => {
                if (!projectToDelete) return;
                setProjects(projects.filter(p => p.id !== projectToDelete));
                if (currentProjectId === projectToDelete) setCurrentProjectId(null);
                setProjectToDelete(null);
            };

            const updateCurrentProject = (updates) => {
                setProjects(projects.map(p => p.id === currentProjectId ? { ...p, ...updates } : p));
            };

            // Drag and Drop Logic for Checklists
            const dragItemIndex = useRef(null);
            const dragOverItemIndex = useRef(null);

            const handleDragStart = (e, index) => {
                dragItemIndex.current = index;
                e.target.classList.add('opacity-50');
            };

            const handleDragEnter = (e, index) => {
                dragOverItemIndex.current = index;
            };

            const handleDragEnd = (e) => {
                e.target.classList.remove('opacity-50');
                if (dragItemIndex.current === null || dragOverItemIndex.current === null) return;
                
                const newList = [...currentProject.checklist];
                const draggedItem = newList.splice(dragItemIndex.current, 1)[0];
                newList.splice(dragOverItemIndex.current, 0, draggedItem);
                
                updateCurrentProject({ checklist: newList });
                dragItemIndex.current = null;
                dragOverItemIndex.current = null;
            };

            const updateChecklistItem = (id, done) => {
                const newList = currentProject.checklist.map(item => item.id === id ? { ...item, done } : item);
                updateCurrentProject({ checklist: newList });
            };

            const addChecklistItem = () => {
                if(newChecklistText.trim()) {
                    updateCurrentProject({ 
                        checklist: [...currentProject.checklist, { id: generateId(), text: newChecklistText, done: false }] 
                    });
                    setNewChecklistText('');
                }
            };

            const deleteChecklistItem = (id) => {
                updateCurrentProject({ 
                    checklist: currentProject.checklist.filter(item => item.id !== id) 
                });
            };

            // Compare Logic
            const updateSpec = (specId, field, value) => {
                const newSpecs = currentProject.comparison.specs.map(s => 
                    s.id === specId ? { ...s, [field]: value } : s
                );
                updateCurrentProject({ 
                    comparison: { ...currentProject.comparison, specs: newSpecs } 
                });
            };

            const addSpecRow = () => {
                if (newSpecKey.trim()) {
                    const newSpecs = [...currentProject.comparison.specs, { id: generateId(), key: newSpecKey, current: '', pred: '', comp: '' }];
                    updateCurrentProject({ 
                        comparison: { ...currentProject.comparison, specs: newSpecs } 
                    });
                    setNewSpecKey('');
                }
            };

            // AI Generation
            const generateDraft = async () => {
                setIsGenerating(true);
                setAiError('');
                const apiKey = ""; // Wird von der Umgebung bereitgestellt
                
                const promptText = `Du bist Henne, ein professioneller, direkter Technik Redakteur für Testsieger TV. 
Schreibe ein detailliertes, flüssig lesbares Review zum Projekt "${currentProject.title}" (Kategorie: ${currentProject.category}).

Hier sind meine Test Notizen und Daten:
${JSON.stringify(currentProject.data, null, 2)}

Hier ist meine abgearbeitete Checkliste. Baue diese Aspekte organisch in den Text ein:
${JSON.stringify(currentProject.checklist.filter(c => c.done).map(c => c.text), null, 2)}

Hier ist der technische Vergleich. Nutze diese Daten für einen eigenen Absatz "Vergleich mit Vorgänger und Konkurrenz":
Vorgänger: ${currentProject.comparison.predecessor || 'Nicht definiert'}
Konkurrent: ${currentProject.comparison.competitor || 'Nicht definiert'}
Spezifikationen:
${JSON.stringify(currentProject.comparison.specs, null, 2)}

Strukturvorgabe:
1. Knackiges Intro
2. Praxistest (basierend auf der Checkliste)
3. Stärken und Schwächen
4. Vergleich mit Vorgänger und Konkurrenz
5. Klares, ehrliches Fazit

Stil: Direkt, fachlich fundiert, keine unnötigen Floskeln.`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: promptText }] }],
                            systemInstruction: { parts: [{ text: "Du bist ein professioneller Technik Redakteur." }] }
                        })
                    });
                    const data = await response.json();
                    const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (generatedText) {
                        updateCurrentProject({ aiDraft: generatedText });
                    } else {
                        throw new Error("Konnte keinen Text generieren. Versuche es nochmal.");
                    }
                } catch (error) {
                    console.error(error);
                    setAiError("Fehler bei der KI Generierung. Bitte versuche es später nochmal.");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="flex h-screen overflow-hidden">
                    
                    {/* SIDEBAR - Project Manager */}
                    <aside className="w-64 glass-panel border-r flex flex-col shrink-0 z-20">
                        <div className="p-4 border-b border-slate-200 dark:border-slate-700 flex justify-between items-center">
                            <h1 className="font-bold text-lg tracking-tight flex items-center gap-2">
                                <span className="w-6 h-6 rounded bg-cyanAccent flex items-center justify-center text-white text-xs">TV</span>
                                Pro Hub
                            </h1>
                        </div>
                        
                        <div className="p-4">
                            <button 
                                onClick={() => setShowNewProjectModal(true)}
                                className="w-full bg-slate-800 dark:bg-slate-200 text-white dark:text-slate-900 py-2 rounded-lg text-sm font-medium flex justify-center items-center gap-2 hover:opacity-90 transition shadow-lg"
                            >
                                <IconPlus /> Neues Projekt
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto p-2">
                            <div className="text-xs font-semibold uppercase opacity-50 px-3 mb-2">Projekte</div>
                            {projects.map(p => (
                                <div 
                                    key={p.id} 
                                    onClick={() => setCurrentProjectId(p.id)}
                                    className={`group flex items-center justify-between p-3 mb-1 rounded-lg cursor-pointer transition ${currentProjectId === p.id ? 'bg-cyanAccent/10 border border-cyanAccent/30 text-cyanAccent' : 'hover:bg-slate-200 dark:hover:bg-slate-800 border border-transparent'}`}
                                >
                                    <div className="truncate text-sm font-medium">{p.title}</div>
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); setProjectToDelete(p.id); }}
                                        className="opacity-0 group-hover:opacity-100 p-1 hover:text-red-500 transition"
                                    >
                                        <IconTrash />
                                    </button>
                                </div>
                            ))}
                            {projects.length === 0 && (
                                <div className="text-sm opacity-50 text-center mt-6 px-4">Keine Projekte vorhanden. Leg eins an.</div>
                            )}
                        </div>
                    </aside>

                    {/* MAIN WORKSPACE */}
                    <main className="flex-1 flex flex-col relative bg-slate-50/50 dark:bg-deepBlue/50">
                        {currentProject ? (
                            <>
                                {/* Project Header & Tabs */}
                                <header className="h-16 border-b border-slate-200 dark:border-slate-700 px-6 flex items-center justify-between shrink-0 bg-white/50 dark:bg-slate-900/50 backdrop-blur-md">
                                    <div className="flex items-center gap-3">
                                        <h2 className="text-xl font-bold">{currentProject.title}</h2>
                                        <span className="px-2 py-0.5 rounded text-xs bg-slate-200 dark:bg-slate-800 uppercase tracking-wider opacity-70">
                                            {currentProject.category}
                                        </span>
                                    </div>
                                    
                                    <div className="flex bg-slate-200 dark:bg-slate-800 p-1 rounded-lg">
                                        <button onClick={() => setActiveTab('checklist')} className={`px-4 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition ${activeTab === 'checklist' ? 'bg-white dark:bg-slate-600 shadow' : 'opacity-60 hover:opacity-100'}`}>
                                            <IconList /> Checkliste
                                        </button>
                                        <button onClick={() => setActiveTab('data')} className={`px-4 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition ${activeTab === 'data' ? 'bg-white dark:bg-slate-600 shadow' : 'opacity-60 hover:opacity-100'}`}>
                                            <IconData /> Base Data
                                        </button>
                                        <button onClick={() => setActiveTab('compare')} className={`px-4 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition ${activeTab === 'compare' ? 'bg-white dark:bg-slate-600 shadow' : 'opacity-60 hover:opacity-100'}`}>
                                            <IconCompare /> Vergleich
                                        </button>
                                        <button onClick={() => setActiveTab('ai')} className={`px-4 py-1.5 rounded-md text-sm font-medium flex items-center gap-2 transition ${activeTab === 'ai' ? 'bg-gradient-to-r from-cyanAccent to-purpleAccent text-white shadow' : 'opacity-60 hover:opacity-100'}`}>
                                            <IconZap /> KI Editor
                                        </button>
                                    </div>
                                </header>

                                {/* Tab Content Area */}
                                <div className="flex-1 overflow-auto p-6">
                                    <div className="max-w-4xl mx-auto">
                                        
                                        {/* TAB: CHECKLIST */}
                                        {activeTab === 'checklist' && (
                                            <div className="glass-panel p-6 rounded-2xl shadow-xl">
                                                <div className="flex justify-between items-center mb-6">
                                                    <h3 className="text-lg font-semibold">Test Checkliste</h3>
                                                </div>
                                                <div className="space-y-2 mb-6">
                                                    {currentProject.checklist.map((item, index) => (
                                                        <div 
                                                            key={item.id}
                                                            draggable
                                                            onDragStart={(e) => handleDragStart(e, index)}
                                                            onDragEnter={(e) => handleDragEnter(e, index)}
                                                            onDragEnd={handleDragEnd}
                                                            onDragOver={(e) => e.preventDefault()}
                                                            className={`flex items-center gap-3 p-3 rounded-lg border border-slate-200 dark:border-slate-700 bg-white/50 dark:bg-slate-800/50 hover:border-cyanAccent/50 transition ${item.done ? 'opacity-50' : ''}`}
                                                        >
                                                            <div className="cursor-grab active:cursor-grabbing text-slate-400">
                                                                <IconGrip />
                                                            </div>
                                                            <input 
                                                                type="checkbox" 
                                                                checked={item.done}
                                                                onChange={(e) => updateChecklistItem(item.id, e.target.checked)}
                                                                className="w-5 h-5 rounded border-slate-400 text-cyanAccent focus:ring-cyanAccent"
                                                            />
                                                            <span className={`flex-1 ${item.done ? 'line-through' : ''}`}>{item.text}</span>
                                                            <button onClick={() => deleteChecklistItem(item.id)} className="text-slate-400 hover:text-red-500 transition">
                                                                <IconTrash />
                                                            </button>
                                                        </div>
                                                    ))}
                                                </div>
                                                <div className="flex items-center gap-3 pt-4 border-t border-slate-200 dark:border-slate-700">
                                                    <input 
                                                        value={newChecklistText}
                                                        onChange={(e) => setNewChecklistText(e.target.value)}
                                                        onKeyDown={(e) => e.key === 'Enter' && addChecklistItem()}
                                                        placeholder="Neuen Testpunkt eingeben..."
                                                        className="flex-1 bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 text-sm glow-focus outline-none"
                                                    />
                                                    <button onClick={addChecklistItem} className="bg-cyanAccent text-white px-5 py-3 rounded-lg text-sm font-medium flex items-center gap-2 shadow hover:shadow-lg transition">
                                                        <IconPlus /> Hinzufügen
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: BASE DATA */}
                                        {activeTab === 'data' && (
                                            <div className="glass-panel p-6 rounded-2xl shadow-xl space-y-6">
                                                <h3 className="text-lg font-semibold">Rohdaten & Notizen</h3>
                                                <div className="grid grid-cols-2 gap-6">
                                                    <div>
                                                        <label className="block text-sm font-medium mb-1 opacity-80">Gesamtnote (Vorab)</label>
                                                        <input 
                                                            type="text" 
                                                            value={currentProject.data.note}
                                                            onChange={(e) => updateCurrentProject({ data: { ...currentProject.data, note: e.target.value }})}
                                                            className="w-full bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 glow-focus"
                                                            placeholder="z.B. 9.2"
                                                        />
                                                    </div>
                                                </div>
                                                <div className="grid grid-cols-2 gap-6">
                                                    <div>
                                                        <label className="block text-sm font-medium mb-1 opacity-80 text-green-500">Pro (Stärken)</label>
                                                        <textarea 
                                                            value={currentProject.data.pros}
                                                            onChange={(e) => updateCurrentProject({ data: { ...currentProject.data, pros: e.target.value }})}
                                                            className="w-full h-32 bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 glow-focus"
                                                            placeholder="Ein Punkt pro Zeile..."
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-sm font-medium mb-1 opacity-80 text-red-500">Contra (Schwächen)</label>
                                                        <textarea 
                                                            value={currentProject.data.cons}
                                                            onChange={(e) => updateCurrentProject({ data: { ...currentProject.data, cons: e.target.value }})}
                                                            className="w-full h-32 bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 glow-focus"
                                                            placeholder="Ein Punkt pro Zeile..."
                                                        />
                                                    </div>
                                                </div>
                                                <div>
                                                    <label className="block text-sm font-medium mb-1 opacity-80">Auffälligkeiten im Testlauf</label>
                                                    <textarea 
                                                        value={currentProject.data.notes}
                                                        onChange={(e) => updateCurrentProject({ data: { ...currentProject.data, notes: e.target.value }})}
                                                        className="w-full h-32 bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 glow-focus"
                                                        placeholder="Macht komische Geräusche beim Teppichübergang..."
                                                    />
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: COMPARE */}
                                        {activeTab === 'compare' && (
                                            <div className="glass-panel p-6 rounded-2xl shadow-xl">
                                                <h3 className="text-lg font-semibold mb-6">Automatischer Technik Vergleich</h3>
                                                
                                                <div className="grid grid-cols-3 gap-4 mb-6">
                                                    <div>
                                                        <label className="block text-xs font-medium mb-1 opacity-50 uppercase">Aktuelles Modell</label>
                                                        <input disabled value={currentProject.title} className="w-full bg-slate-100 dark:bg-slate-900 border border-transparent rounded-lg p-2 text-sm opacity-70" />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium mb-1 opacity-50 uppercase">Vorgänger</label>
                                                        <input 
                                                            value={currentProject.comparison.predecessor} 
                                                            onChange={(e) => updateCurrentProject({ comparison: { ...currentProject.comparison, predecessor: e.target.value }})}
                                                            className="w-full bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-2 text-sm glow-focus" 
                                                            placeholder="z.B. Dreame L10s Ultra" 
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-medium mb-1 opacity-50 uppercase">Konkurrent</label>
                                                        <input 
                                                            value={currentProject.comparison.competitor} 
                                                            onChange={(e) => updateCurrentProject({ comparison: { ...currentProject.comparison, competitor: e.target.value }})}
                                                            className="w-full bg-slate-200 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-2 text-sm glow-focus" 
                                                            placeholder="z.B. Roborock S8 Pro" 
                                                        />
                                                    </div>
                                                </div>

                                                <div className="border border-slate-200 dark:border-slate-700 rounded-lg overflow-hidden">
                                                    <table className="w-full text-sm text-left">
                                                        <thead className="text-xs uppercase bg-slate-100 dark:bg-slate-800 opacity-80">
                                                            <tr>
                                                                <th className="px-4 py-3 w-1/4">Eigenschaft</th>
                                                                <th className="px-4 py-3 w-1/4">Aktuell</th>
                                                                <th className="px-4 py-3 w-1/4">Vorgänger</th>
                                                                <th className="px-4 py-3 w-1/4">Konkurrent</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            {currentProject.comparison.specs.map((spec) => (
                                                                <tr key={spec.id} className="border-b border-slate-200 dark:border-slate-700 hover:bg-slate-50 dark:hover:bg-slate-800/50">
                                                                    <td className="px-4 py-2">
                                                                        <input value={spec.key} onChange={(e) => updateSpec(spec.id, 'key', e.target.value)} className="w-full bg-transparent border-none outline-none font-medium" />
                                                                    </td>
                                                                    <td className="px-4 py-2"><input value={spec.current} onChange={(e) => updateSpec(spec.id, 'current', e.target.value)} className="w-full bg-transparent border-none outline-none focus:ring-1 focus:ring-cyanAccent rounded px-1" placeholder="Wert..." /></td>
                                                                    <td className="px-4 py-2"><input value={spec.pred} onChange={(e) => updateSpec(spec.id, 'pred', e.target.value)} className="w-full bg-transparent border-none outline-none focus:ring-1 focus:ring-cyanAccent rounded px-1" placeholder="Wert..." /></td>
                                                                <td className="px-4 py-2"><input value={spec.comp} onChange={(e) => updateSpec(spec.id, 'comp', e.target.value)} className="w-full bg-transparent border-none outline-none focus:ring-1 focus:ring-cyanAccent rounded px-1" placeholder="Wert..." /></td>
                                                            </tr>
                                                        ))}
                                                    </tbody>
                                                </table>
                                            </div>
                                            <div className="flex items-center gap-3 mt-4 pt-4 border-t border-slate-200 dark:border-slate-700">
                                                <input 
                                                    value={newSpecKey}
                                                    onChange={(e) => setNewSpecKey(e.target.value)}
                                                    onKeyDown={(e) => e.key === 'Enter' && addSpecRow()}
                                                    placeholder="Neue Eigenschaft (z.B. Ladezeit)..."
                                                    className="flex-1 bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 text-sm glow-focus outline-none"
                                                />
                                                <button onClick={addSpecRow} className="bg-cyanAccent text-white px-5 py-3 rounded-lg text-sm font-medium flex items-center gap-2 shadow hover:shadow-lg transition">
                                                    <IconPlus /> Eigenschaft anlegen
                                                </button>
                                            </div>
                                        </div>
                                    )}

                                    {/* TAB: AI EDITOR */}
                                        {activeTab === 'ai' && (
                                            <div className="glass-panel p-6 rounded-2xl shadow-xl flex flex-col h-[70vh]">
                                                <div className="flex justify-between items-center mb-4">
                                                    <h3 className="text-lg font-semibold flex items-center gap-2">KI Draft Generation</h3>
                                                    <button 
                                                        onClick={generateDraft}
                                                        disabled={isGenerating}
                                                        className="bg-gradient-to-r from-cyanAccent to-purpleAccent text-white px-6 py-2 rounded-lg font-medium shadow-lg hover:shadow-xl transition-all disabled:opacity-50 flex items-center gap-2"
                                                    >
                                                        {isGenerating ? 'Generiere...' : 'Review schreiben lassen'}
                                                    </button>
                                                </div>
                                                <div className="text-xs opacity-60 mb-4 bg-slate-200 dark:bg-slate-800 p-3 rounded">
                                                Die KI analysiert nun deine abgeleistete Checkliste, die Stärken und Schwächen und wertet die Vergleichstabelle automatisch aus, um einen fundierten Text zu erstellen.
                                            </div>
                                            {aiError && (
                                                <div className="text-sm text-red-500 mb-4 bg-red-500/10 p-3 rounded border border-red-500/20">
                                                    {aiError}
                                                </div>
                                            )}
                                            <textarea
                                                className="flex-1 w-full bg-slate-100 dark:bg-slate-900 border border-slate-300 dark:border-slate-700 rounded-lg p-4 resize-none glow-focus leading-relaxed"
                                                    value={currentProject.aiDraft}
                                                    onChange={(e) => updateCurrentProject({ aiDraft: e.target.value })}
                                                    placeholder="Klicke auf 'Review schreiben lassen'..."
                                                ></textarea>
                                            </div>
                                        )}

                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center opacity-50">
                            <IconZap />
                            <p className="mt-4">Wähle ein Projekt links aus oder erstelle ein neues.</p>
                        </div>
                    )}
                </main>

                {/* MODALS */}
                
                {/* Create Project Modal */}
                {showNewProjectModal && (
                    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                        <div className="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl p-6 max-w-sm w-full shadow-2xl">
                            <h3 className="text-xl font-bold mb-4">Neues Projekt anlegen</h3>
                            <div className="space-y-4 mb-6">
                                <div>
                                    <label className="block text-sm font-medium mb-1 opacity-80">Projektname</label>
                                    <input 
                                        value={newProjectTitle}
                                        onChange={(e) => setNewProjectTitle(e.target.value)}
                                        autoFocus
                                        className="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 outline-none focus:border-cyanAccent text-sm"
                                        placeholder="z.B. Dreame L20 Ultra"
                                    />
                                </div>
                                <div>
                                    <label className="block text-sm font-medium mb-1 opacity-80">Kategorie</label>
                                    <select 
                                        value={newProjectCategory}
                                        onChange={(e) => setNewProjectCategory(e.target.value)}
                                        className="w-full bg-slate-100 dark:bg-slate-800 border border-slate-300 dark:border-slate-700 rounded-lg p-3 outline-none focus:border-cyanAccent text-sm"
                                    >
                                        {CATEGORIES.map(c => (
                                            <option key={c.id} value={c.id}>{c.name}</option>
                                        ))}
                                    </select>
                                </div>
                            </div>
                            <div className="flex justify-end gap-3">
                                <button onClick={() => setShowNewProjectModal(false)} className="px-4 py-2 rounded-lg opacity-70 hover:bg-slate-200 dark:hover:bg-slate-800 transition text-sm">Abbrechen</button>
                                <button onClick={handleCreateProject} className="bg-cyanAccent text-white px-6 py-2 rounded-lg font-medium shadow hover:shadow-lg transition text-sm">Erstellen</button>
                            </div>
                        </div>
                    </div>
                )}

                {/* Delete Confirm Modal */}
                {projectToDelete && (
                    <div className="fixed inset-0 bg-black/60 backdrop-blur-sm z-50 flex items-center justify-center p-4">
                        <div className="bg-white dark:bg-slate-900 border border-slate-200 dark:border-slate-700 rounded-2xl p-6 max-w-sm w-full shadow-2xl text-center">
                            <div className="w-12 h-12 bg-red-500/10 text-red-500 rounded-full flex items-center justify-center mx-auto mb-4">
                                <IconTrash />
                            </div>
                            <h3 className="text-lg font-bold mb-2">Projekt wirklich löschen?</h3>
                            <p className="text-sm opacity-70 mb-6">Das kann nicht rückgängig gemacht werden. Alle Daten und Texte gehen verloren.</p>
                            <div className="flex justify-center gap-3">
                                <button onClick={() => setProjectToDelete(null)} className="px-4 py-2 rounded-lg opacity-70 hover:bg-slate-200 dark:hover:bg-slate-800 transition text-sm">Abbrechen</button>
                                <button onClick={confirmDeleteProject} className="bg-red-500 text-white px-6 py-2 rounded-lg font-medium shadow hover:shadow-lg transition text-sm">Ja, löschen</button>
                            </div>
                        </div>
                    </div>
                )}

            </div>
        );
    };

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<App />);
</script>
</body>
</html>
