<!DOCTYPE html>
<html lang="de" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Testsieger-TV | Pro Hub</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        deepBlue: '#050A15',
                        slateGray: '#1E293B',
                        cyanAccent: '#00F0FF',
                        purpleAccent: '#B026FF',
                        brandOrange: '#FF7B00',
                        lightBg: '#F8FAFC'
                    },
                    animation: {
                        'blob': 'blob 10s infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        blob: {
                            '0%': { transform: 'translate(0px, 0px) scale(1)' },
                            '33%': { transform: 'translate(30px, -50px) scale(1.1)' },
                            '66%': { transform: 'translate(-20px, 20px) scale(0.9)' },
                            '100%': { transform: 'translate(0px, 0px) scale(1)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(100,100,100,0.3); border-radius: 10px; }
        .dark ::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.2); }
        ::-webkit-scrollbar-thumb:hover { background: #FF7B00; }
        
        /* LIQUID GLASS DESIGN - LIGHT & DARK */
        .glass-panel {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(255, 255, 255, 0.3));
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.1);
            border-top: 1px solid rgba(255,255,255,0.8);
            border-left: 1px solid rgba(255,255,255,0.6);
        }
        
        .dark .glass-panel {
            background: linear-gradient(135deg, rgba(20, 25, 40, 0.6), rgba(10, 15, 25, 0.4));
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-top: 1px solid rgba(255,255,255,0.15);
            border-left: 1px solid rgba(255,255,255,0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.3);
        }
        
        .glow-focus:focus {
            box-shadow: 0 0 20px rgba(255, 123, 0, 0.3);
            border-color: #FF7B00;
            outline: none;
            background: rgba(255,255,255,0.5);
        }
        .dark .glow-focus:focus {
            background: rgba(255,255,255,0.05);
        }

        .dragging {
            opacity: 0.4;
            transform: scale(0.95) rotate(2deg);
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }
        .dark .dragging {
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }

        /* Animated Background Gradients */
        .bg-mesh {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            z-index: -1;
            background-color: #E2E8F0;
            overflow: hidden;
            transition: background-color 0.3s;
        }
        .dark .bg-mesh {
            background-color: #050A15;
        }
        .bg-mesh::before, .bg-mesh::after {
            content: '';
            position: absolute;
            border-radius: 50%;
            filter: blur(120px);
            opacity: 0.2;
            animation: blob 15s infinite alternate;
        }
        .bg-mesh::before {
            background: #B026FF;
            width: 50vw; height: 50vw;
            top: -10vw; left: -10vw;
        }
        .bg-mesh::after {
            background: #FF7B00;
            width: 40vw; height: 40vw;
            bottom: -5vw; right: -10vw;
            animation-delay: -5s;
        }
    </style>
</head>
<body class="text-slate-900 dark:text-slate-100 transition-colors duration-300 overflow-hidden">
    
    <div class="bg-mesh"></div>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useCallback, useRef } = React;

        // --- ICONS ---
        const IconSettings = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="3"></circle><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"></path></svg>;
        const IconPlus = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>;
        const IconTrash = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2-2v2"></path></svg>;
        const IconGrip = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className="cursor-grab active:cursor-grabbing text-slate-400 dark:text-white/30 hover:text-brandOrange transition-colors"><circle cx="9" cy="12" r="1"></circle><circle cx="9" cy="5" r="1"></circle><circle cx="9" cy="19" r="1"></circle><circle cx="15" cy="12" r="1"></circle><circle cx="15" cy="5" r="1"></circle><circle cx="15" cy="19" r="1"></circle></svg>;
        const IconList = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><line x1="8" y1="6" x2="21" y2="6"></line><line x1="8" y1="12" x2="21" y2="12"></line><line x1="8" y1="18" x2="21" y2="18"></line><line x1="3" y1="6" x2="3.01" y2="6"></line><line x1="3" y1="12" x2="3.01" y2="12"></line><line x1="3" y1="18" x2="3.01" y2="18"></line></svg>;
        const IconData = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><ellipse cx="12" cy="5" rx="9" ry="3"></ellipse><path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path><path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path></svg>;
        const IconCompare = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="18" cy="18" r="3"></circle><circle cx="6" cy="6" r="3"></circle><path d="M13 6h3a2 2 0 0 1 2 2v7"></path><line x1="6" y1="9" x2="6" y2="21"></line></svg>;
        const IconZap = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"></polygon></svg>;
        const IconEdit = () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>;
        const IconChevronDown = ({ className }) => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}><polyline points="6 9 12 15 18 9"></polyline></svg>;
        const IconCamera = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z"></path><circle cx="12" cy="13" r="3"></circle></svg>;
        const IconSun = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><circle cx="12" cy="12" r="4"></circle><path d="M12 2v2"></path><path d="M12 20v2"></path><path d="m4.93 4.93 1.41 1.41"></path><path d="m17.66 17.66 1.41 1.41"></path><path d="M2 12h2"></path><path d="M20 12h2"></path><path d="m6.34 17.66-1.41 1.41"></path><path d="m19.07 4.93-1.41 1.41"></path></svg>;
        const IconMoon = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"></path></svg>;
        const IconMagic = () => <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="m21.64 3.64-1.28-1.28a1.21 1.21 0 0 0-1.72 0L2.36 18.64a1.21 1.21 0 0 0 0 1.72l1.28 1.28a1.2 1.2 0 0 0 1.72 0L21.64 5.36a1.2 1.2 0 0 0 0-1.72Z"></path><path d="m14 7 3 3"></path><path d="M5 6v4"></path><path d="M19 14v4"></path><path d="M10 2v2"></path><path d="M7 8H3"></path><path d="M21 16h-4"></path><path d="M11 3H9"></path></svg>;

        // --- BRAND LOGO COMPONENT ---
        const BrandLogo = () => (
            <div className="flex items-center gap-2 select-none pointer-events-none">
                <svg width="44" height="28" viewBox="0 0 100 60" fill="none" stroke="#FF7B00" strokeWidth="5" strokeLinecap="round" strokeLinejoin="round">
                    <path d="M 30 20 L 70 20 L 60 30 L 40 30 Z" fill="#FF7B00" />
                    <line x1="8" y1="14" x2="35" y2="14" />
                    <line x1="65" y1="14" x2="92" y2="14" />
                    <line x1="20" y1="14" x2="20" y2="22" />
                    <line x1="80" y1="14" x2="80" y2="22" />
                    <path d="M 40 30 L 25 45 M 60 30 L 75 45" />
                    <line x1="20" y1="45" x2="30" y2="45" />
                    <line x1="70" y1="45" x2="80" y2="45" />
                    <rect x="38" y="36" width="24" height="18" rx="4" fill="none" />
                    <polygon points="46,40 56,45 46,50" fill="#FF7B00" stroke="none" />
                </svg>
                <div className="flex flex-col justify-center leading-none mt-1">
                    <span className="text-brandOrange font-black text-[11px] tracking-widest uppercase" style={{ letterSpacing: '0.15em' }}>Test</span>
                    <div className="flex items-center gap-1.5 -mt-0.5">
                        <span className="text-slate-900 dark:text-white font-black text-xl tracking-tight leading-none">SIEGER</span>
                        <span className="bg-brandOrange text-white text-[10px] font-bold px-1.5 py-0.5 rounded-md leading-none">TV</span>
                    </div>
                </div>
            </div>
        );

        // --- DYNAMIC CONFIG & TEMPLATES ---
        const INITIAL_CATEGORIES = [
            { id: 'saugroboter', name: 'Saugroboter' },
            { id: 'rasenmaehroboter', name: 'Rasenmähroboter' },
            { id: 'technik', name: 'Technik generell' }
        ];

        const DEFAULT_SPECS_TEMPLATES = {
            saugroboter: ['Saugkraft (Pa)', 'Navigationstechnik', 'Hinderniserkennung (Kamera/Laser)', 'Wischsystem (Rotierend/Vibrierend)', 'Station (Absaugung/Wasser/Trocknung)', 'Akkukapazität (mAh)', 'Bauhöhe (cm)', 'Preis (UVP)'],
            rasenmaehroboter: ['Max. Flächenleistung (m²)', 'Navigation (RTK/Kabel/Kamera)', 'Max. Steigung (%)', 'Schnitthöhe (mm)', 'Schnittbreite (cm)', 'Diebstahlschutz', 'Regensensor', 'Preis (UVP)'],
            technik: ['Prozessor / SoC', 'Arbeitsspeicher (RAM)', 'Interner Speicher', 'Display (Typ, Hz, Auflösung)', 'Akku / Ladeleistung', 'Gewicht (g)', 'Besonderheit 1', 'Preis (UVP)']
        };

        const WORKFLOWS = {
            saugroboter: {
                checklist: [
                    { phase: "Phase 1: Vorbereitung", items: ["Auspacken: Inhalt prüfen & Vollständigkeit checken", "Auspacken: Erste Notizen machen", "Lieferumfang: Abgleich mit Herstellerangaben & Besonderheiten notieren", "Design und Verarbeitung: Material, Verarbeitung & Haptik bewerten"] },
                    { phase: "Phase 2: Einrichtung und App", items: ["Station aufstellen: Station platzieren, Mopps einsetzen, Wasser füllen", "App einrichten: App installieren, Roboter koppeln, Dauer bewerten", "Erste Kartierung: Dauer messen, Raumaufteilung prüfen"] },
                    { phase: "Phase 3: Navigation und Hindernisse", items: ["Test-Parcours: 5 große Hindernisse, 5 kleine (Kabel, Schnürsenkel, etc.) vorbereiten", "Hindernistest: Reaktion beobachten, Trefferquote notieren", "Alltagsnavigation: Verhalten unter Tischen/Stühlen bewerten"] },
                    { phase: "Phase 4: Saugleistung", items: ["Hartboden-Test: Staub und Krümel verteilen, ein Durchgang", "Teppich-Test: 50 g Schmutz abwiegen (Kurzflor und Hochflor)"] },
                    { phase: "Phase 5: Wischleistung", items: ["Wischtest vorbereiten: Kaffee und Ketchup antrocknen lassen", "Mehrfachdurchgänge: Durchgang 1, 2 und 4 dokumentieren & bewerten"] },
                    { phase: "Phase 6: Spezialtests", items: ["Haaraufnahme: Lange Haare verteilen, Anti-Tangle prüfen", "Ecken und Kanten: 10 Haferflocken in Ecke platzieren"] },
                    { phase: "Phase 7: Station und Wartung", items: ["Automatische Reinigung: Moppreinigung beobachten, Lautstärke einschätzen", "Wartungszugang: Filter entnehmen, Bürste entnehmen, Reinigung bewerten"] },
                    { phase: "Phase 8: Vergleich und Fazit", items: ["Gerätevergleich: Gen 2 vs Gen 3 vs Konkurrenz bewerten", "Fazit schreiben: Zielgruppe definieren, Empfehlung klar formulieren", "Abschluss-Check: Bilder/Werte konsequent gleichmäßig? Keine Werbesprache?"] }
                ],
                shotlist: [
                    { phase: "Phase 1: Vorbereitung", items: ["Karton geöffnet von oben", "Komplettes Zubehör sauber ausgelegt", "Basisstation einzeln", "Roboter einzeln", "Mopps, Staubbeutel, Reinigungsmittel als Detailaufnahme", "Roboter frontal, seitlich & von oben", "Station frontal & schräg für Tiefenwirkung"] },
                    { phase: "Phase 2: Einrichtung und App", items: ["Station am finalen Standort", "Mopps eingesetzt von unten", "Smartphone mit App-Startscreen", "Kopplungsvorgang in der App", "Screenshot der vollständigen Karte", "Screenshot mit Raumaufteilung"] },
                    { phase: "Phase 3: Navigation und Hindernisse", items: ["Gesamtübersicht Parcours", "Detail flache Hindernisse", "Roboter vor Hindernis", "Roboter beim Umfahren", "App-Screenshot erkannter Objekte"] },
                    { phase: "Phase 4: Saugleistung", items: ["Verschmutzung vorher (Hartboden)", "Ergebnis nach Reinigung (Hartboden)", "Abgewogener Schmutz (Teppich)", "Teppich nach Reinigung"] },
                    { phase: "Phase 5: Wischleistung", items: ["Verschmutzung frisch", "Verschmutzung angetrocknet", "Gleiche Perspektive nach jedem Durchgang"] },
                    { phase: "Phase 6: Spezialtests", items: ["Haare vor Reinigung", "Bürste nach dem Test", "Ecke vorher", "Ecke nachher"] },
                    { phase: "Phase 7: Station und Wartung", items: ["Roboter in Station", "Mopps nach Reinigung", "Offener Staubbehälter", "Herausgenommene Bürste"] },
                    { phase: "Phase 8: Vergleich und Fazit", items: ["Geräte nebeneinander (Optional)", "Alternativ neutraler Produktshot"] }
                ],
                scores: { verarbeitung: 5, saugleistung: 5, wischleistung: 5, navigation: 5, app: 5, preis_leistung: 5 }
            },
            rasenmaehroboter: {
                checklist: [
                    { phase: "Phase 1: Vorbereitung & Design", items: ["Unboxing & Lieferumfang prüfen (Kabel, Heringe, RTK-Antenne?)", "Design, Verarbeitung & Messer-Typ prüfen"] },
                    { phase: "Phase 2: Setup & App", items: ["Station aufbauen & Antenne/Kabel verlegen", "App Kopplung & WLAN/Mobilfunk-Verbindung testen", "Erste Kartierung (Zonenerstellung, No-Go-Areas)"] },
                    { phase: "Phase 3: Mähleistung", items: ["Mähleistung Standard (Trockenes Gras, normale Höhe)", "Mähleistung Extrem (Hohes Gras, nasses Gras)"] },
                    { phase: "Phase 4: Navigation & Hindernisse", items: ["Kantenmähfunktion & Überfahr-Abstand testen", "Hinderniserkennung (Gartenschlauch, Spielzeug, Igel-Dummy)", "Steigungstest (Schafft er die beworbene Steigung?)"] },
                    { phase: "Phase 5: Wartung & Fazit", items: ["App Features prüfen (Zeitpläne, Schnitthöhenverstellung)", "Wartung (Reinigung mit Schlauch möglich?, Messerwechsel)", "Gerätevergleich & Fazit"] }
                ],
                shotlist: [
                    { phase: "Phase 1: Vorbereitung & Design", items: ["Unboxing & Lieferumfang", "Roboter & Station (Produktshots)", "Messerwerk von unten (Detail)"] },
                    { phase: "Phase 2: Setup & App", items: ["Station im Garten aufgebaut", "Screenshot: App-Karte mit Zonen"] },
                    { phase: "Phase 3: Mähleistung", items: ["Schnittbild Rasen (Vorher/Nachher Detail)", "Aktion: Roboter mäht Rasenkante"] },
                    { phase: "Phase 4: Navigation & Hindernisse", items: ["Aktion: Roboter weicht Hindernis aus", "Roboter an Steigung"] },
                    { phase: "Phase 5: Wartung & Fazit", items: ["Wartungszugang (z.B. Reinigung mit Schlauch)"] }
                ],
                scores: { verarbeitung: 5, maehleisung: 5, navigation: 5, app: 5, preis_leistung: 5 }
            },
            technik: {
                checklist: [
                    { phase: "Phase 1: Unboxing & Design", items: ["Unboxing & Erster Eindruck", "Verarbeitungsqualität & Materialcheck"] },
                    { phase: "Phase 2: Setup & Basics", items: ["Setup & Einrichtungsprozess", "Display / Bedienelemente prüfen"] },
                    { phase: "Phase 3: Praxistest", items: ["Kernfunktionen testen", "Akkulaufzeit & Ladezeit messen", "Software, Menüführung & App-Anbindung prüfen"] },
                    { phase: "Phase 4: Fazit", items: ["Stärken / Schwächen Analyse", "Vergleich & Fazit"] }
                ],
                shotlist: [
                    { phase: "Phase 1: Unboxing & Design", items: ["Lieferumfang Übersicht", "Gerät Frontal & Rückseite", "Detailaufnahme Anschlüsse/Buttons"] },
                    { phase: "Phase 2 & 3: Praxistest", items: ["Gerät in Action / im Einsatz", "Screenshot/Foto vom Setup-Prozess"] },
                    { phase: "Phase 4: Fazit", items: ["Größenvergleich mit bekanntem Objekt"] }
                ],
                scores: { design_verarbeitung: 5, bedienung: 5, leistung: 5, akku: 5, preis_leistung: 5 }
            }
        };

        const generateId = () => Math.random().toString(36).substr(2, 9);

        // --- COMPONENTS ---

        const App = () => {
            // State
            const [theme, setTheme] = useState(() => localStorage.getItem('ttv_theme') || 'dark');
            const [categories, setCategories] = useState(() => JSON.parse(localStorage.getItem('ttv_categories')) || INITIAL_CATEGORIES);
            const [projects, setProjects] = useState(() => JSON.parse(localStorage.getItem('ttv_projects')) || []);
            const [currentProjectId, setCurrentProjectId] = useState(null);
            const [activeTab, setActiveTab] = useState('checklist');
            
            const [isGenerating, setIsGenerating] = useState(false);
            const [isAutoFilling, setIsAutoFilling] = useState(false);
            const [aiError, setAiError] = useState('');
            const [apiKey, setApiKey] = useState(() => localStorage.getItem('ttv_apikey') || '');
            const [showSettingsModal, setShowSettingsModal] = useState(false);

            // UI Modal States
            const [showNewProjectModal, setShowNewProjectModal] = useState(false);
            const [newProjectTitle, setNewProjectTitle] = useState('');
            const [newProjectCategory, setNewProjectCategory] = useState(categories[0]?.id || 'saugroboter');
            const [isCreatingCategory, setIsCreatingCategory] = useState(false);
            const [newCustomCategory, setNewCustomCategory] = useState('');
            const [projectToDelete, setProjectToDelete] = useState(null);

            // Editing Title State
            const [isEditingTitle, setIsEditingTitle] = useState(false);
            const [editTitleValue, setEditTitleValue] = useState('');

            // List UI States
            const [newChecklistText, setNewChecklistText] = useState({});
            const [newShotlistText, setNewShotlistText] = useState({});
            const [expandedChecklistId, setExpandedChecklistId] = useState(null);
            const [collapsedPhases, setCollapsedPhases] = useState({}); // { checklist_phaseIndex: boolean }

            // Inline Input States
            const [newSpecKey, setNewSpecKey] = useState('');
            const [newProText, setNewProText] = useState('');
            const [newConText, setNewConText] = useState('');

            // Apply Theme
            useEffect(() => {
                if (theme === 'dark') document.documentElement.classList.add('dark');
                else document.documentElement.classList.remove('dark');
                localStorage.setItem('ttv_theme', theme);
            }, [theme]);

            // Persist Data
            useEffect(() => {
                localStorage.setItem('ttv_categories', JSON.stringify(categories));
                localStorage.setItem('ttv_projects', JSON.stringify(projects));
            }, [categories, projects]);

            const currentProject = projects.find(p => p.id === currentProjectId);

            // Data Migration for older projects (pros/cons from string to array, and checklist to nested phases)
            useEffect(() => {
                if (!projects || projects.length === 0) return;
                let needsMigration = false;
                
                const migratedProjects = projects.map(p => {
                    let updated = { ...p };
                    
                    // Migrate Pros/Cons
                    if (typeof updated.data?.pros === 'string') {
                        needsMigration = true;
                        updated.data = {
                            ...updated.data,
                            pros: updated.data.pros ? updated.data.pros.split('\n').filter(Boolean) : [],
                            cons: updated.data.cons ? updated.data.cons.split('\n').filter(Boolean) : [],
                            conditions: updated.data.conditions || 'Standard Laborumgebung'
                        };
                    }

                    // Migrate Checklist to Phased Structure
                    if (updated.checklist && updated.checklist.length > 0 && !updated.checklist[0].phase && !updated.checklist[0].items) {
                        needsMigration = true;
                        updated.checklist = [{ phase: "Allgemeine Tests", items: updated.checklist }];
                    }
                    if (updated.shotlist && updated.shotlist.length > 0 && !updated.shotlist[0].phase && !updated.shotlist[0].items) {
                        needsMigration = true;
                        updated.shotlist = [{ phase: "Allgemeine Motive", items: updated.shotlist }];
                    }

                    return updated;
                });

                if (needsMigration) setProjects(migratedProjects);
            }, [projects.length]); // Only run on mount or project creation

            // Auto-calculate Score
            const calculatedScore = useMemo(() => {
                if (!currentProject || !currentProject.scores) return "0.0";
                const values = Object.values(currentProject.scores);
                if (values.length === 0) return "0.0";
                const sum = values.reduce((a, b) => a + b, 0);
                return (sum / values.length).toFixed(1);
            }, [currentProject?.scores]);

            // Project Management
            const handleCreateProject = () => {
                if (!newProjectTitle.trim()) return;
                
                let catId = newProjectCategory;

                if (isCreatingCategory && newCustomCategory.trim()) {
                    catId = newCustomCategory.trim().toLowerCase().replace(/[^a-z0-9]/g, '_');
                    if (!categories.find(c => c.id === catId)) {
                        setCategories([...categories, { id: catId, name: newCustomCategory.trim() }]);
                    }
                }

                const workflowTemplate = WORKFLOWS[catId] || WORKFLOWS.technik;
                const specKeys = DEFAULT_SPECS_TEMPLATES[catId] || DEFAULT_SPECS_TEMPLATES.technik;

                const newProject = {
                    id: generateId(),
                    title: newProjectTitle,
                    category: catId,
                    createdAt: new Date().toISOString(),
                    // Map the phased template to instances with IDs
                    checklist: workflowTemplate.checklist.map(phaseBlock => ({
                        phase: phaseBlock.phase,
                        items: phaseBlock.items.map(text => ({ id: generateId(), text, done: false, note: '' }))
                    })),
                    shotlist: workflowTemplate.shotlist.map(phaseBlock => ({
                        phase: phaseBlock.phase,
                        items: phaseBlock.items.map(text => ({ id: generateId(), text, done: false }))
                    })),
                    scores: { ...workflowTemplate.scores },
                    data: { pros: [], cons: [], notes: '', conditions: 'Firmware: \nTestdauer: \nBodenbeläge: Hartboden, Teppich' },
                    comparison: {
                        model: newProjectTitle,
                        predecessor: '',
                        competitor: '',
                        specs: specKeys.map(key => ({ id: generateId(), key, current: '', pred: '', comp: '' }))
                    },
                    aiDraft: ''
                };
                
                setProjects([...projects, newProject]);
                setCurrentProjectId(newProject.id);
                setActiveTab('checklist');
                setShowNewProjectModal(false);
                setNewProjectTitle('');
                setIsCreatingCategory(false);
                setNewCustomCategory('');
            };

            const confirmDeleteProject = () => {
                if (!projectToDelete) return;
                setProjects(projects.filter(p => p.id !== projectToDelete));
                if (currentProjectId === projectToDelete) setCurrentProjectId(null);
                setProjectToDelete(null);
            };

            const updateCurrentProject = (updates) => {
                setProjects(projects.map(p => p.id === currentProjectId ? { ...p, ...updates } : p));
            };

            const handleTitleSave = () => {
                if (editTitleValue.trim()) {
                    updateCurrentProject({ title: editTitleValue.trim() });
                }
                setIsEditingTitle(false);
            };

            // --- DRAG AND DROP: PROJECTS ---
            const dragProjectIndex = useRef(null);
            const dragOverProjectIndex = useRef(null);

            const handleProjectDragStart = (e, index) => {
                dragProjectIndex.current = index;
                e.currentTarget.classList.add('opacity-40', 'scale-95');
            };
            const handleProjectDragEnter = (e, index) => { dragOverProjectIndex.current = index; };
            const handleProjectDragEnd = (e) => {
                e.currentTarget.classList.remove('opacity-40', 'scale-95');
                if (dragProjectIndex.current === null || dragOverProjectIndex.current === null) return;
                if (dragProjectIndex.current === dragOverProjectIndex.current) return;
                
                const newProjects = [...projects];
                const draggedProject = newProjects.splice(dragProjectIndex.current, 1)[0];
                newProjects.splice(dragOverProjectIndex.current, 0, draggedProject);
                
                setProjects(newProjects);
                dragProjectIndex.current = null;
                dragOverProjectIndex.current = null;
            };

            // --- DRAG AND DROP: NESTED LISTS (Checklist & Shotlist) ---
            const dragNestedItem = useRef({ phaseIndex: null, itemIndex: null });
            const dragOverNestedItem = useRef({ phaseIndex: null, itemIndex: null });

            const handleNestedDragStart = (e, phaseIndex, itemIndex) => {
                dragNestedItem.current = { phaseIndex, itemIndex };
                e.currentTarget.classList.add('dragging');
            };
            const handleNestedDragEnter = (e, phaseIndex, itemIndex) => { 
                dragOverNestedItem.current = { phaseIndex, itemIndex }; 
            };
            const handleNestedDragEnd = (e, listKey) => {
                e.currentTarget.classList.remove('dragging');
                const { phaseIndex: fromPhase, itemIndex: fromItem } = dragNestedItem.current;
                const { phaseIndex: toPhase, itemIndex: toItem } = dragOverNestedItem.current;

                if (fromPhase === null || toPhase === null) return;

                const newList = [...currentProject[listKey]];
                // Remove from source
                const draggedItem = newList[fromPhase].items.splice(fromItem, 1)[0];
                // Insert to target
                newList[toPhase].items.splice(toItem, 0, draggedItem);
                
                updateCurrentProject({ [listKey]: newList });
                dragNestedItem.current = { phaseIndex: null, itemIndex: null };
                dragOverNestedItem.current = { phaseIndex: null, itemIndex: null };
            };

            // Nested List Data Handlers
            const updateNestedItem = (listKey, phaseIndex, itemId, field, value) => {
                const newList = [...currentProject[listKey]];
                newList[phaseIndex].items = newList[phaseIndex].items.map(item => 
                    item.id === itemId ? { ...item, [field]: value } : item
                );
                updateCurrentProject({ [listKey]: newList });
            };

            const addNestedItem = (listKey, phaseIndex, textVal, setInputState) => {
                if(textVal && textVal.trim()) {
                    const newList = [...currentProject[listKey]];
                    const newItem = { id: generateId(), text: textVal.trim(), done: false };
                    if (listKey === 'checklist') newItem.note = '';
                    
                    newList[phaseIndex].items.push(newItem);
                    updateCurrentProject({ [listKey]: newList });
                    
                    setInputState(prev => ({...prev, [phaseIndex]: ''}));
                }
            };

            const deleteNestedItem = (listKey, phaseIndex, itemId) => {
                const newList = [...currentProject[listKey]];
                newList[phaseIndex].items = newList[phaseIndex].items.filter(item => item.id !== itemId);
                updateCurrentProject({ [listKey]: newList });
            };

            const togglePhaseCollapse = (listKey, phaseIndex) => {
                const key = `${listKey}_${phaseIndex}`;
                setCollapsedPhases(prev => ({ ...prev, [key]: !prev[key] }));
            };

            // Array Manipulations for Pros/Cons
            const addProCon = (type, val, setValFn) => {
                if (val.trim()) {
                    updateCurrentProject({ data: { ...currentProject.data, [type]: [...currentProject.data[type], val.trim()] } });
                    setValFn('');
                }
            };
            const removeProCon = (type, index) => {
                const arr = [...currentProject.data[type]];
                arr.splice(index, 1);
                updateCurrentProject({ data: { ...currentProject.data, [type]: arr } });
            };

            // Compare Logic
            const updateSpec = (specId, field, value) => {
                const newSpecs = currentProject.comparison.specs.map(s => 
                    s.id === specId ? { ...s, [field]: value } : s
                );
                updateCurrentProject({ comparison: { ...currentProject.comparison, specs: newSpecs } });
            };

            const addSpecRow = () => {
                if (newSpecKey.trim()) {
                    const newSpecs = [...currentProject.comparison.specs, { id: generateId(), key: newSpecKey, current: '', pred: '', comp: '' }];
                    updateCurrentProject({ comparison: { ...currentProject.comparison, specs: newSpecs } });
                    setNewSpecKey('');
                }
            };

            // AI Features
            const runAutoFillData = async () => {
                if (!apiKey) {
                    setShowSettingsModal(true);
                    return;
                }
                setIsAutoFilling(true);
                setAiError('');

                const catName = categories.find(c => c.id === currentProject.category)?.name || currentProject.category;
                const specKeysStr = currentProject.comparison.specs.map(s => s.key).join(", ");

                const prompt = `Du bist ein Tech-Experte. Fülle die Daten für das Produkt "${currentProject.title}" (Kategorie: ${catName}) aus.
Recherchiere die echten Spezifikationen so gut du kannst.
Antworte AUSSCHLIESSLICH mit einem validen JSON-Objekt. Keine Markdown-Blöcke (\`\`\`json), kein Text davor oder danach.

Struktur des JSON:
{
  "predecessor": "Name des direkten Vorgängers (z.B. L10s Ultra)",
  "competitor": "Name des stärksten direkten Konkurrenten einer anderen Marke",
  "pros": ["Stärke 1", "Stärke 2", "Stärke 3"],
  "cons": ["Schwäche 1", "Schwäche 2"],
  "specs": {
    "SCHLÜSSEL_AUS_DER_LISTE": {
      "current": "Wert für ${currentProject.title}",
      "pred": "Wert für Vorgänger",
      "comp": "Wert für Konkurrent"
    }
  }
}
Verwende exakt diese Schlüssel für das specs-Objekt: ${specKeysStr}. 
Wenn du Werte nicht genau kennst, nutze realistische Schätzungen oder schreibe "k.A.".`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: prompt }] }],
                            systemInstruction: { parts: [{ text: "Du lieferst ausschließlich reines JSON zurück." }] }
                        })
                    });
                    const data = await response.json();
                    let generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (!generatedText) throw new Error("Keine Antwort von der KI erhalten.");

                    generatedText = generatedText.replace(/```json/g, '').replace(/```/g, '').trim();
                    const parsedData = JSON.parse(generatedText);

                    const updatedSpecs = currentProject.comparison.specs.map(spec => {
                        const aiSpec = parsedData.specs[spec.key];
                        if (aiSpec) {
                            return { ...spec, current: aiSpec.current || '', pred: aiSpec.pred || '', comp: aiSpec.comp || '' };
                        }
                        return spec;
                    });

                    updateCurrentProject({
                        comparison: {
                            ...currentProject.comparison,
                            predecessor: parsedData.predecessor || currentProject.comparison.predecessor,
                            competitor: parsedData.competitor || currentProject.comparison.competitor,
                            specs: updatedSpecs
                        },
                        data: {
                            ...currentProject.data,
                            pros: parsedData.pros || currentProject.data.pros,
                            cons: parsedData.cons || currentProject.data.cons
                        }
                    });

                } catch (error) {
                    console.error("AutoFill Error:", error);
                    setAiError("Fehler beim Auto-Fill. Die KI hat kein sauberes JSON geliefert oder der Key ist falsch.");
                } finally {
                    setIsAutoFilling(false);
                }
            };

            const generateDraft = async () => {
                if (!apiKey) {
                    setShowSettingsModal(true);
                    return;
                }
                setIsGenerating(true);
                setAiError('');
                
                const catName = categories.find(c => c.id === currentProject.category)?.name || currentProject.category;

                // Format checklists beautifully for the AI
                let checklistNotes = "";
                (currentProject.checklist || []).forEach(phase => {
                    const completedItems = phase.items.filter(i => i.done);
                    if(completedItems.length > 0) {
                        checklistNotes += `\n[${phase.phase}]\n`;
                        completedItems.forEach(i => {
                            checklistNotes += `* ${i.text}${i.note ? ` (Detail-Notiz: ${i.note})` : ''}\n`;
                        });
                    }
                });

                const proConsText = `Stärken: ${currentProject.data.pros.join(', ')}\nSchwächen: ${currentProject.data.cons.join(', ')}`;

                const promptText = `Du bist Henne, ein professioneller, direkter Technik Redakteur für Testsieger TV. 
Schreibe einen detaillierten, flüssig lesbaren Testbericht zum Projekt "${currentProject.title}" (Kategorie: ${catName}).

WICHTIGSTE REGELN FÜR DEINEN SCHREIBSTIL:
1. Nutze NIEMALS Gedankenstriche. Lass sie immer weg.
2. Sei ein kritischer Sparringspartner. Benenne Schwächen schonungslos ehrlich, aber bleib fair und konstruktiv. Kein Marketing-Sprech.
3. Dein Ton ist natürlich, direkt, gewitzt und professionell, als würdest du mit einem anderen Profi sprechen.
4. Strukturiere den Text mit starken, leserfreundlichen Zwischenüberschriften.

ORIENTIERE DICH AN DIESER STRUKTUR (Beispiel Saugroboter, passe es sinngemäß auf die Kategorie an):
1. Catchy Intro: Kontext zum Hersteller, hohe Erwartungen wecken, zentrale Frage des Tests aufwerfen.
2. Technische Details & Lieferumfang: Fokus auf das Wesentliche. Fehlt etwas für den Preis?
3. Design und Verarbeitung: Optik, Haptik, praktische Implikationen des Designs.
4. Die All-in-One-Station (falls vorhanden): Autonomie-Check. Was macht sie wirklich selbst?
5. Einrichtung & App: Usability, Stabilität, fehlende Features.
6. Navigation & Hinderniserkennung: Souveränität im Alltag vs. Test-Parcours. Schwächen aufzeigen.
7. Praxistest Saugen & Wischen: Hartboden, Teppich, Ecken, Haaraufnahme. Wie geht das Gerät mit echten Herausforderungen um?
8. Wartung & Lautstärke: Alltagstauglichkeit.
9. Gerätevergleich: Wie schlägt sich das Gerät gegen Vorgänger (${currentProject.comparison.predecessor || 'k.A.'}) und Konkurrenz (${currentProject.comparison.competitor || 'k.A.'})?
10. Klares Fazit: Zielgruppe definieren, klare Empfehlung oder Nicht-Empfehlung (inklusive Gesamtnote ${calculatedScore}/10).

DATEN FÜR DEINEN BERICHT:
Testbedingungen: ${currentProject.data.conditions}
Gesamtnote: ${calculatedScore}/10
${proConsText}
Spezifikationen: ${JSON.stringify(currentProject.comparison.specs)}

CHECKLISTEN-NOTIZEN UND ERGEBNISSE AUS DEM LABOR (Zwingend organisch in den Text einbauen!):
${checklistNotes}
`;

                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: promptText }] }],
                            systemInstruction: { parts: [{ text: "Du bist ein professioneller Technik Redakteur. Nutze einen direkten, lockeren Ton. Verwende NIEMALS Gedankenstriche." }] }
                        })
                    });
                    const data = await response.json();
                    const generatedText = data.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (generatedText) {
                        updateCurrentProject({ aiDraft: generatedText });
                    } else {
                        throw new Error("Konnte keinen Text generieren.");
                    }
                } catch (error) {
                    console.error(error);
                    setAiError("Fehler bei der KI Generierung. Überprüfe deinen API-Key und die Verbindung.");
                } finally {
                    setIsGenerating(false);
                }
            };

            return (
                <div className="flex h-screen overflow-hidden text-slate-800 dark:text-white transition-colors duration-300">
                    
                    {/* SIDEBAR - Project Manager */}
                    <aside className="w-[300px] glass-panel border-r border-slate-300/50 dark:border-white/10 flex flex-col shrink-0 z-20 shadow-2xl">
                        <div className="p-6 border-b border-slate-300/50 dark:border-white/10 flex justify-between items-center bg-white/20 dark:bg-white/5">
                            <BrandLogo />
                            <div className="flex gap-2">
                                <button onClick={() => setShowSettingsModal(true)} className="p-2 rounded-full hover:bg-slate-200/50 dark:hover:bg-white/10 transition">
                                    <IconSettings />
                                </button>
                                <button onClick={() => setTheme(theme === 'dark' ? 'light' : 'dark')} className="p-2 rounded-full hover:bg-slate-200/50 dark:hover:bg-white/10 transition">
                                    {theme === 'dark' ? <IconSun /> : <IconMoon />}
                                </button>
                            </div>
                        </div>
                        
                        <div className="p-5">
                            <button 
                                onClick={() => { setIsCreatingCategory(false); setShowNewProjectModal(true); }}
                                className="w-full bg-white/50 dark:bg-white/10 hover:bg-white/80 dark:hover:bg-white/20 border border-slate-300/50 dark:border-brandOrange/50 text-slate-800 dark:text-white py-3 rounded-xl text-sm font-bold flex justify-center items-center gap-2 transition-all shadow-[0_4px_15px_rgba(0,0,0,0.05)] dark:shadow-[0_4px_15px_rgba(255,123,0,0.15)] hover:shadow-[0_4px_25px_rgba(255,123,0,0.3)] backdrop-blur-sm"
                            >
                                <IconPlus /> Neues Projekt
                            </button>
                        </div>

                        <div className="flex-1 overflow-y-auto px-3 pb-6">
                            <div className="text-xs font-bold uppercase text-slate-500 dark:text-white/40 px-3 mb-3 tracking-widest flex items-center justify-between">
                                Deine Projekte
                                <IconGrip className="w-3 h-3 opacity-50" />
                            </div>
                            <div className="space-y-2">
                                {projects.map((p, index) => (
                                    <div 
                                        key={p.id}
                                        draggable
                                        onDragStart={(e) => handleProjectDragStart(e, index)}
                                        onDragEnter={(e) => handleProjectDragEnter(e, index)}
                                        onDragEnd={handleProjectDragEnd}
                                        onDragOver={(e) => e.preventDefault()}
                                        onClick={() => setCurrentProjectId(p.id)}
                                        className={`group flex items-center justify-between p-3 rounded-xl cursor-pointer transition-all duration-200 ${currentProjectId === p.id ? 'bg-brandOrange/10 dark:bg-brandOrange/20 border border-brandOrange/50 shadow-[0_0_20px_rgba(255,123,0,0.15)] text-slate-900 dark:text-white' : 'hover:bg-white/40 dark:hover:bg-white/10 border border-transparent text-slate-600 dark:text-white/70 hover:text-slate-900 dark:hover:text-white'}`}
                                    >
                                        <div className="flex items-center gap-2 overflow-hidden">
                                            <div className="cursor-grab active:cursor-grabbing text-slate-300 dark:text-white/20 hover:text-brandOrange"><IconGrip /></div>
                                            <div className="truncate text-sm font-medium">{p.title}</div>
                                        </div>
                                        <button 
                                            onClick={(e) => { e.stopPropagation(); setProjectToDelete(p.id); }}
                                            className="opacity-0 group-hover:opacity-100 p-1.5 hover:text-red-500 hover:bg-red-100 dark:hover:bg-red-500/20 rounded-md transition"
                                        >
                                            <IconTrash />
                                        </button>
                                    </div>
                                ))}
                                {projects.length === 0 && (
                                    <div className="text-sm text-slate-500 dark:text-white/30 text-center mt-10 px-4 border border-dashed border-slate-300 dark:border-white/10 rounded-xl p-6">Keine Projekte vorhanden. <br/>Klick auf 'Neues Projekt'.</div>
                                )}
                            </div>
                        </div>
                    </aside>

                    {/* MAIN WORKSPACE */}
                    <main className="flex-1 flex flex-col relative z-10">
                        {currentProject ? (
                            <>
                                {/* Project Header & Tabs */}
                                <header className="h-20 border-b border-slate-300/50 dark:border-white/10 px-8 flex items-center justify-between shrink-0 glass-panel !border-l-0 !border-t-0 !border-r-0 !rounded-none z-20">
                                    
                                    {/* Editable Title & Magic Wand */}
                                    <div className="flex items-center gap-4">
                                        {isEditingTitle ? (
                                            <input 
                                                autoFocus
                                                value={editTitleValue}
                                                onChange={(e) => setEditTitleValue(e.target.value)}
                                                onBlur={handleTitleSave}
                                                onKeyDown={(e) => e.key === 'Enter' && handleTitleSave()}
                                                className="bg-white/50 dark:bg-white/10 border border-brandOrange rounded-lg px-3 py-1.5 text-2xl font-bold text-slate-900 dark:text-white outline-none w-64 shadow-[0_0_15px_rgba(255,123,0,0.2)]"
                                            />
                                        ) : (
                                            <h2 className="text-2xl font-bold flex items-center gap-3 cursor-pointer group" onClick={() => { setEditTitleValue(currentProject.title); setIsEditingTitle(true); }}>
                                                {currentProject.title}
                                                <span className="opacity-0 group-hover:opacity-50 text-brandOrange transition"><IconEdit /></span>
                                            </h2>
                                        )}
                                        <span className="px-3 py-1 rounded-full text-xs font-semibold bg-white/50 dark:bg-white/10 border border-slate-300 dark:border-white/10 uppercase tracking-widest text-brandOrange shadow-[inset_0_0_10px_rgba(255,255,255,0.05)]">
                                            {categories.find(c => c.id === currentProject.category)?.name || currentProject.category}
                                        </span>

                                        {/* AUTO-FILL BUTTON */}
                                        <button 
                                            onClick={runAutoFillData}
                                            disabled={isAutoFilling}
                                            className="ml-4 flex items-center gap-2 text-xs font-bold uppercase tracking-wider bg-gradient-to-r from-brandOrange to-purpleAccent text-white px-4 py-1.5 rounded-full shadow-[0_0_15px_rgba(255,123,0,0.4)] hover:shadow-[0_0_25px_rgba(255,123,0,0.6)] transition-all disabled:opacity-50"
                                            title="KI lädt Vorgänger, Konkurrenten und Specs automatisch"
                                        >
                                            <IconMagic /> {isAutoFilling ? 'Recherchiere...' : 'KI Auto-Fill'}
                                        </button>
                                    </div>
                                    
                                    {/* Glass Tabs */}
                                    <div className="flex bg-white/40 dark:bg-black/20 p-1.5 rounded-xl border border-slate-300/50 dark:border-white/10 backdrop-blur-xl">
                                        <button onClick={() => setActiveTab('checklist')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeTab === 'checklist' ? 'bg-white/80 dark:bg-white/20 shadow-[0_4px_12px_rgba(0,0,0,0.1)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.3)] border border-white/50 dark:border-white/20' : 'text-slate-500 dark:text-white/50 hover:text-slate-900 dark:hover:text-white hover:bg-white/40 dark:hover:bg-white/5'}`}>
                                            <IconList /> Checkliste
                                        </button>
                                        <button onClick={() => setActiveTab('shotlist')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeTab === 'shotlist' ? 'bg-white/80 dark:bg-white/20 shadow-[0_4px_12px_rgba(0,0,0,0.1)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.3)] border border-white/50 dark:border-white/20' : 'text-slate-500 dark:text-white/50 hover:text-slate-900 dark:hover:text-white hover:bg-white/40 dark:hover:bg-white/5'}`}>
                                            <IconCamera /> Shotlist
                                        </button>
                                        <button onClick={() => setActiveTab('data')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeTab === 'data' ? 'bg-white/80 dark:bg-white/20 shadow-[0_4px_12px_rgba(0,0,0,0.1)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.3)] border border-white/50 dark:border-white/20' : 'text-slate-500 dark:text-white/50 hover:text-slate-900 dark:hover:text-white hover:bg-white/40 dark:hover:bg-white/5'}`}>
                                            <IconData /> Base Data
                                        </button>
                                        <button onClick={() => setActiveTab('compare')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeTab === 'compare' ? 'bg-white/80 dark:bg-white/20 shadow-[0_4px_12px_rgba(0,0,0,0.1)] dark:shadow-[0_4px_12px_rgba(0,0,0,0.3)] border border-white/50 dark:border-white/20' : 'text-slate-500 dark:text-white/50 hover:text-slate-900 dark:hover:text-white hover:bg-white/40 dark:hover:bg-white/5'}`}>
                                            <IconCompare /> Vergleich
                                        </button>
                                        <button onClick={() => setActiveTab('ai')} className={`px-4 py-2 rounded-lg text-sm font-medium flex items-center gap-2 transition-all ${activeTab === 'ai' ? 'bg-gradient-to-r from-brandOrange/90 to-purpleAccent/90 shadow-[0_4px_20px_rgba(255,123,0,0.4)] border border-brandOrange/50 text-white' : 'text-slate-500 dark:text-white/50 hover:text-slate-900 dark:hover:text-white hover:bg-white/40 dark:hover:bg-white/5'}`}>
                                            <IconZap /> KI Editor
                                        </button>
                                    </div>
                                </header>

                                {/* Tab Content Area */}
                                <div className="flex-1 overflow-auto p-8 relative z-10">
                                    <div className="max-w-5xl mx-auto">
                                        
                                        {aiError && (
                                            <div className="mb-6 bg-red-100 dark:bg-red-900/40 p-4 rounded-xl border border-red-500/30 text-sm text-red-600 dark:text-red-200">
                                                {aiError}
                                            </div>
                                        )}

                                        {/* TAB: CHECKLIST */}
                                        {activeTab === 'checklist' && (
                                            <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl relative overflow-hidden">
                                                <div className="absolute top-0 right-0 w-64 h-64 bg-cyanAccent/20 dark:bg-cyanAccent/10 blur-[100px] pointer-events-none rounded-full"></div>
                                                
                                                <h3 className="text-xl font-bold mb-8 text-slate-800 dark:text-transparent dark:bg-clip-text dark:bg-gradient-to-r dark:from-white dark:to-white/60">Strukturierte Test Checkliste</h3>
                                                
                                                <div className="space-y-6 mb-8">
                                                    {(currentProject.checklist || []).map((phaseBlock, phaseIndex) => {
                                                        const isCollapsed = collapsedPhases[`checklist_${phaseIndex}`];
                                                        const completedCount = phaseBlock.items.filter(i => i.done).length;
                                                        const totalCount = phaseBlock.items.length;
                                                        const isPhaseDone = totalCount > 0 && completedCount === totalCount;

                                                        return (
                                                        <div key={phaseIndex} className={`glass-panel !bg-white/40 dark:!bg-white/5 !border-slate-300/50 dark:!border-white/10 rounded-2xl overflow-hidden transition-all duration-300`}>
                                                            {/* Phase Header */}
                                                            <div 
                                                                onClick={() => togglePhaseCollapse('checklist', phaseIndex)}
                                                                className={`flex items-center justify-between p-4 cursor-pointer hover:bg-white/50 dark:hover:bg-white/10 transition-colors ${isPhaseDone ? 'bg-green-500/10' : ''}`}
                                                            >
                                                                <div className="flex items-center gap-3">
                                                                    <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${isPhaseDone ? 'bg-green-500 text-white' : 'bg-slate-300 dark:bg-white/20 text-slate-700 dark:text-white'}`}>
                                                                        {isPhaseDone ? '✓' : completedCount}
                                                                    </div>
                                                                    <h4 className={`font-bold text-lg ${isPhaseDone ? 'text-green-600 dark:text-green-400' : 'text-slate-800 dark:text-white'}`}>{phaseBlock.phase}</h4>
                                                                    <span className="text-xs text-slate-500 dark:text-white/40">({completedCount}/{totalCount})</span>
                                                                </div>
                                                                <IconChevronDown className={`transition-transform duration-300 text-slate-500 dark:text-white/50 ${isCollapsed ? '' : 'rotate-180'}`} />
                                                            </div>

                                                            {/* Phase Items */}
                                                            <div className={`transition-all duration-500 overflow-hidden ${isCollapsed ? 'max-h-0' : 'max-h-[2000px]'}`}>
                                                                <div className="p-4 pt-0 space-y-3">
                                                                    {phaseBlock.items.map((item, itemIndex) => (
                                                                        <div 
                                                                            key={item.id} 
                                                                            draggable
                                                                            onDragStart={(e) => handleNestedDragStart(e, phaseIndex, itemIndex)}
                                                                            onDragEnter={(e) => handleNestedDragEnter(e, phaseIndex, itemIndex)}
                                                                            onDragEnd={(e) => handleNestedDragEnd(e, 'checklist')}
                                                                            onDragOver={(e) => e.preventDefault()}
                                                                            className={`group bg-white/60 dark:bg-black/20 border border-slate-300/50 dark:border-white/10 rounded-xl overflow-hidden transition-all duration-300 hover:border-cyanAccent/30 ${item.done ? 'opacity-60 bg-slate-200/50 dark:bg-black/40' : ''}`}
                                                                        >
                                                                            <div className="flex items-center gap-4 p-3">
                                                                                <div className="cursor-grab active:cursor-grabbing text-slate-400 dark:text-white/30 hover:text-cyanAccent transition">
                                                                                    <IconGrip />
                                                                                </div>
                                                                                <input 
                                                                                    type="checkbox" 
                                                                                    checked={item.done}
                                                                                    onChange={(e) => updateNestedItem('checklist', phaseIndex, item.id, 'done', e.target.checked)}
                                                                                    className="w-5 h-5 rounded border-slate-300 dark:border-white/20 bg-white dark:bg-black/50 text-cyanAccent focus:ring-cyanAccent accent-cyanAccent cursor-pointer"
                                                                                />
                                                                                <span className={`flex-1 font-medium text-[15px] ${item.done ? 'line-through text-slate-500 dark:text-white/50' : 'text-slate-700 dark:text-white/90'}`}>{item.text}</span>
                                                                                
                                                                                <button 
                                                                                    onClick={() => setExpandedChecklistId(expandedChecklistId === item.id ? null : item.id)} 
                                                                                    className={`p-1.5 rounded-lg hover:bg-white dark:hover:bg-white/10 transition flex items-center gap-2 text-xs font-bold uppercase tracking-wider ${expandedChecklistId === item.id ? 'text-cyanAccent bg-cyanAccent/10' : 'text-slate-500 dark:text-white/60'}`}
                                                                                >
                                                                                    {item.note ? 'Notiz ansehen' : 'Notiz +'}
                                                                                </button>
                                                                                
                                                                                <button onClick={() => deleteNestedItem('checklist', phaseIndex, item.id)} className="opacity-0 group-hover:opacity-100 text-slate-400 dark:text-white/30 hover:text-red-500 dark:hover:text-red-400 p-1.5 rounded-lg transition">
                                                                                    <IconTrash />
                                                                                </button>
                                                                            </div>

                                                                            {/* EXPANDED NOTES AREA */}
                                                                            {expandedChecklistId === item.id && (
                                                                                <div className="px-12 pb-4 pt-1 bg-slate-100/50 dark:bg-black/40">
                                                                                    <label className="block text-[10px] uppercase tracking-widest text-cyanAccent/80 dark:text-cyanAccent/80 mb-2 font-semibold">Ergebnis / Detail-Notiz für KI</label>
                                                                                    <textarea 
                                                                                        value={item.note || ''}
                                                                                        onChange={(e) => updateNestedItem('checklist', phaseIndex, item.id, 'note', e.target.value)}
                                                                                        placeholder="Ergebnis eintragen. Z.B. Kabel hat sich verfangen..."
                                                                                        className="w-full bg-white/80 dark:bg-black/50 border border-slate-300/50 dark:border-white/10 rounded-lg p-3 text-sm text-slate-800 dark:text-white/90 placeholder-slate-400 dark:placeholder-white/30 focus:border-cyanAccent/50 outline-none min-h-[80px] shadow-inner"
                                                                                    />
                                                                                </div>
                                                                            )}
                                                                        </div>
                                                                    ))}
                                                                    
                                                                    {/* Add new item to phase */}
                                                                    <div className="flex items-center gap-2 mt-2">
                                                                        <input 
                                                                            value={newChecklistText[phaseIndex] || ''}
                                                                            onChange={(e) => setNewChecklistText(prev => ({...prev, [phaseIndex]: e.target.value}))}
                                                                            onKeyDown={(e) => e.key === 'Enter' && addNestedItem('checklist', phaseIndex, newChecklistText[phaseIndex], setNewChecklistText)}
                                                                            placeholder="Neuen Testpunkt anhängen..."
                                                                            className="flex-1 bg-white/40 dark:bg-white/5 border border-transparent rounded-lg p-2.5 text-sm outline-none focus:border-cyanAccent/50 focus:bg-white/80 dark:focus:bg-black/40 transition-all"
                                                                        />
                                                                        <button onClick={() => addNestedItem('checklist', phaseIndex, newChecklistText[phaseIndex], setNewChecklistText)} className="text-cyanAccent hover:bg-cyanAccent/10 p-2 rounded-lg transition"><IconPlus /></button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )})}
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: SHOTLIST */}
                                        {activeTab === 'shotlist' && (
                                            <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl relative overflow-hidden">
                                                <div className="absolute top-0 right-0 w-64 h-64 bg-purpleAccent/20 dark:bg-purpleAccent/10 blur-[100px] pointer-events-none rounded-full"></div>

                                                <div className="flex justify-between items-center mb-6">
                                                    <h3 className="text-xl font-bold text-purpleAccent dark:text-transparent dark:bg-clip-text dark:bg-gradient-to-r dark:from-purpleAccent dark:to-cyanAccent flex items-center gap-3">
                                                        <IconCamera /> Strukturierte Media Shotlist
                                                    </h3>
                                                    <span className="text-xs bg-purpleAccent/10 dark:bg-purpleAccent/20 text-purpleAccent border border-purpleAccent/30 px-3 py-1 rounded-full uppercase tracking-wider font-bold">Vergiss keine Fotos!</span>
                                                </div>
                                                <p className="text-slate-600 dark:text-white/60 text-sm mb-8">Hake ab, welche Fotos, B-Rolls oder Screenshots du in der jeweiligen Testphase bereits gemacht hast.</p>

                                                <div className="space-y-6 mb-8">
                                                    {(currentProject.shotlist || []).map((phaseBlock, phaseIndex) => {
                                                        const isCollapsed = collapsedPhases[`shotlist_${phaseIndex}`];
                                                        const completedCount = phaseBlock.items.filter(i => i.done).length;
                                                        const totalCount = phaseBlock.items.length;
                                                        const isPhaseDone = totalCount > 0 && completedCount === totalCount;

                                                        return (
                                                        <div key={phaseIndex} className={`glass-panel !bg-white/40 dark:!bg-white/5 !border-slate-300/50 dark:!border-white/10 rounded-2xl overflow-hidden transition-all duration-300`}>
                                                            {/* Phase Header */}
                                                            <div 
                                                                onClick={() => togglePhaseCollapse('shotlist', phaseIndex)}
                                                                className={`flex items-center justify-between p-4 cursor-pointer hover:bg-white/50 dark:hover:bg-white/10 transition-colors ${isPhaseDone ? 'bg-green-500/10' : ''}`}
                                                            >
                                                                <div className="flex items-center gap-3">
                                                                    <div className={`w-6 h-6 rounded-full flex items-center justify-center text-xs font-bold ${isPhaseDone ? 'bg-green-500 text-white' : 'bg-slate-300 dark:bg-white/20 text-slate-700 dark:text-white'}`}>
                                                                        {isPhaseDone ? '✓' : completedCount}
                                                                    </div>
                                                                    <h4 className={`font-bold text-lg ${isPhaseDone ? 'text-green-600 dark:text-green-400' : 'text-slate-800 dark:text-white'}`}>{phaseBlock.phase}</h4>
                                                                    <span className="text-xs text-slate-500 dark:text-white/40">({completedCount}/{totalCount})</span>
                                                                </div>
                                                                <IconChevronDown className={`transition-transform duration-300 text-slate-500 dark:text-white/50 ${isCollapsed ? '' : 'rotate-180'}`} />
                                                            </div>

                                                            {/* Phase Items */}
                                                            <div className={`transition-all duration-500 overflow-hidden ${isCollapsed ? 'max-h-0' : 'max-h-[2000px]'}`}>
                                                                <div className="p-4 pt-0 grid grid-cols-1 md:grid-cols-2 gap-3">
                                                                    {phaseBlock.items.map((item, itemIndex) => (
                                                                        <div 
                                                                            key={item.id} 
                                                                            draggable
                                                                            onDragStart={(e) => handleNestedDragStart(e, phaseIndex, itemIndex)}
                                                                            onDragEnter={(e) => handleNestedDragEnter(e, phaseIndex, itemIndex)}
                                                                            onDragEnd={(e) => handleNestedDragEnd(e, 'shotlist')}
                                                                            onDragOver={(e) => e.preventDefault()}
                                                                            className={`group flex items-center gap-3 p-3 rounded-xl border border-slate-300/50 dark:border-white/10 bg-white/60 dark:bg-black/20 transition-all hover:border-purpleAccent/30 ${item.done ? 'opacity-50 border-green-500/30 bg-green-100 dark:bg-green-900/10' : ''}`}
                                                                        >
                                                                            <div className="cursor-grab active:cursor-grabbing text-slate-400 dark:text-white/30 hover:text-purpleAccent transition"><IconGrip /></div>
                                                                            <input 
                                                                                type="checkbox" 
                                                                                checked={item.done}
                                                                                onChange={(e) => updateNestedItem('shotlist', phaseIndex, item.id, 'done', e.target.checked)}
                                                                                className="w-5 h-5 rounded border-slate-300 dark:border-white/20 bg-white dark:bg-black/50 accent-purpleAccent cursor-pointer"
                                                                            />
                                                                            <span className={`flex-1 font-medium text-sm ${item.done ? 'line-through text-slate-500 dark:text-white/50' : 'text-slate-700 dark:text-white/90'}`}>{item.text}</span>
                                                                            <button onClick={() => deleteNestedItem('shotlist', phaseIndex, item.id)} className="opacity-0 group-hover:opacity-100 text-slate-400 dark:text-white/30 hover:text-red-500 dark:hover:text-red-400 p-1 rounded-lg transition">
                                                                                <IconTrash />
                                                                            </button>
                                                                        </div>
                                                                    ))}
                                                                    
                                                                    {/* Add new item to phase */}
                                                                    <div className="flex items-center gap-2 col-span-full mt-1">
                                                                        <input 
                                                                            value={newShotlistText[phaseIndex] || ''}
                                                                            onChange={(e) => setNewShotlistText(prev => ({...prev, [phaseIndex]: e.target.value}))}
                                                                            onKeyDown={(e) => e.key === 'Enter' && addNestedItem('shotlist', phaseIndex, newShotlistText[phaseIndex], setNewShotlistText)}
                                                                            placeholder="Neues Motiv anhängen..."
                                                                            className="flex-1 bg-white/40 dark:bg-white/5 border border-transparent rounded-lg p-2.5 text-sm outline-none focus:border-purpleAccent/50 focus:bg-white/80 dark:focus:bg-black/40 transition-all"
                                                                        />
                                                                        <button onClick={() => addNestedItem('shotlist', phaseIndex, newShotlistText[phaseIndex], setNewShotlistText)} className="text-purpleAccent hover:bg-purpleAccent/10 p-2 rounded-lg transition"><IconPlus /></button>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    )})}
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: BASE DATA & SMART SCORECARD */}
                                        {activeTab === 'data' && (
                                            <div className="space-y-6">
                                                
                                                {/* Smart Scorecard Box */}
                                                <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl relative overflow-hidden">
                                                    <div className="absolute top-[-50px] right-[-50px] w-48 h-48 bg-brandOrange/10 dark:bg-brandOrange/20 blur-[80px] rounded-full pointer-events-none"></div>
                                                    
                                                    <div className="flex justify-between items-start mb-8">
                                                        <div>
                                                            <h3 className="text-xl font-bold mb-1">Smart Scorecard</h3>
                                                            <p className="text-sm text-slate-600 dark:text-white/50">Bewerte die Kriterien per Slider. Die Gesamtnote wird dynamisch berechnet.</p>
                                                        </div>
                                                        <div className="bg-white/80 dark:bg-black/40 border border-brandOrange/50 dark:border-brandOrange/30 px-6 py-3 rounded-2xl flex flex-col items-center shadow-[0_0_30px_rgba(255,123,0,0.15)]">
                                                            <span className="text-xs font-bold text-brandOrange uppercase tracking-widest mb-1">Gesamtnote</span>
                                                            <span className="text-4xl font-black text-slate-800 dark:text-white">{calculatedScore} <span className="text-lg text-slate-400 dark:text-white/40">/10</span></span>
                                                        </div>
                                                    </div>

                                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                                                        {Object.entries(currentProject.scores || {}).map(([key, val]) => (
                                                            <div key={key} className="bg-white/40 dark:bg-white/5 p-4 rounded-xl border border-slate-300/50 dark:border-white/10">
                                                                <div className="flex justify-between items-center mb-3">
                                                                    <label className="text-sm font-bold uppercase tracking-wider text-slate-700 dark:text-white/80">{key.replace('_', ' ')}</label>
                                                                    <span className="bg-slate-200 dark:bg-black/50 text-brandOrange font-mono px-2 py-1 rounded text-sm">{val} / 10</span>
                                                                </div>
                                                                <input 
                                                                    type="range" min="1" max="10" step="1" value={val}
                                                                    onChange={(e) => updateCurrentProject({ scores: { ...currentProject.scores, [key]: parseInt(e.target.value) } })}
                                                                    className="w-full h-2 bg-slate-300 dark:bg-black/50 rounded-lg appearance-none cursor-pointer accent-brandOrange"
                                                                />
                                                            </div>
                                                        ))}
                                                    </div>
                                                </div>

                                                {/* DYNAMIC FACT-SHEET (Replaces old static text areas) */}
                                                <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl space-y-8">
                                                    
                                                    {/* Test Conditions */}
                                                    <div>
                                                        <h3 className="text-lg font-bold mb-4 uppercase tracking-widest text-slate-700 dark:text-white/80">Test-Bedingungen (Fact-Sheet)</h3>
                                                        <textarea 
                                                            value={currentProject.data.conditions}
                                                            onChange={(e) => updateCurrentProject({ data: { ...currentProject.data, conditions: e.target.value }})}
                                                            className="w-full h-24 bg-white/60 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-xl p-4 text-sm text-slate-800 dark:text-white/90 placeholder-slate-400 dark:placeholder-white/20 outline-none focus:border-cyanAccent shadow-inner leading-relaxed"
                                                            placeholder="Firmware Version, Testdauer, Bodenbeläge..."
                                                        />
                                                    </div>

                                                    <div className="grid grid-cols-2 gap-8 pt-4 border-t border-slate-300/50 dark:border-white/10">
                                                        {/* Pros List */}
                                                        <div>
                                                            <label className="block text-sm font-bold mb-3 uppercase tracking-widest text-green-600 dark:text-green-400 flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-green-500"></div> Stärken (Pro)</label>
                                                            <div className="space-y-2 mb-3">
                                                                {(currentProject.data.pros || []).map((pro, idx) => (
                                                                    <div key={idx} className="flex items-center gap-2 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-500/20 px-3 py-2 rounded-lg text-sm text-slate-800 dark:text-white/90">
                                                                        <span className="flex-1">{pro}</span>
                                                                        <button onClick={() => removeProCon('pros', idx)} className="text-slate-400 hover:text-red-500"><IconTrash /></button>
                                                                    </div>
                                                                ))}
                                                                {currentProject.data.pros.length === 0 && <div className="text-sm text-slate-400 dark:text-white/30 italic">Noch keine Stärken erfasst.</div>}
                                                            </div>
                                                            <div className="flex gap-2">
                                                                <input 
                                                                    value={newProText}
                                                                    onChange={(e) => setNewProText(e.target.value)}
                                                                    onKeyDown={(e) => e.key === 'Enter' && addProCon('pros', newProText, setNewProText)}
                                                                    className="flex-1 bg-white/60 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-lg px-3 py-2 text-sm outline-none focus:border-green-500 shadow-inner"
                                                                    placeholder="Neue Stärke..."
                                                                />
                                                                <button onClick={() => addProCon('pros', newProText, setNewProText)} className="bg-white/50 dark:bg-white/10 hover:bg-green-100 dark:hover:bg-green-500/20 px-3 py-2 rounded-lg text-slate-600 dark:text-white transition"><IconPlus /></button>
                                                            </div>
                                                        </div>

                                                        {/* Cons List */}
                                                        <div>
                                                            <label className="block text-sm font-bold mb-3 uppercase tracking-widest text-red-600 dark:text-red-400 flex items-center gap-2"><div className="w-2 h-2 rounded-full bg-red-500"></div> Schwächen (Contra)</label>
                                                            <div className="space-y-2 mb-3">
                                                                {(currentProject.data.cons || []).map((con, idx) => (
                                                                    <div key={idx} className="flex items-center gap-2 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-500/20 px-3 py-2 rounded-lg text-sm text-slate-800 dark:text-white/90">
                                                                        <span className="flex-1">{con}</span>
                                                                        <button onClick={() => removeProCon('cons', idx)} className="text-slate-400 hover:text-red-500"><IconTrash /></button>
                                                                    </div>
                                                                ))}
                                                                {currentProject.data.cons.length === 0 && <div className="text-sm text-slate-400 dark:text-white/30 italic">Noch keine Schwächen erfasst.</div>}
                                                            </div>
                                                            <div className="flex gap-2">
                                                                <input 
                                                                    value={newConText}
                                                                    onChange={(e) => setNewConText(e.target.value)}
                                                                    onKeyDown={(e) => e.key === 'Enter' && addProCon('cons', newConText, setNewConText)}
                                                                    className="flex-1 bg-white/60 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-lg px-3 py-2 text-sm outline-none focus:border-red-500 shadow-inner"
                                                                    placeholder="Neue Schwäche..."
                                                                />
                                                                <button onClick={() => addProCon('cons', newConText, setNewConText)} className="bg-white/50 dark:bg-white/10 hover:bg-red-100 dark:hover:bg-red-500/20 px-3 py-2 rounded-lg text-slate-600 dark:text-white transition"><IconPlus /></button>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: COMPARE */}
                                        {activeTab === 'compare' && (
                                            <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl">
                                                <div className="flex justify-between items-center mb-8">
                                                    <h3 className="text-xl font-bold text-slate-800 dark:text-transparent dark:bg-clip-text dark:bg-gradient-to-r dark:from-white dark:to-white/60">Technik Vergleich</h3>
                                                    <button onClick={runAutoFillData} disabled={isAutoFilling} className="flex items-center gap-2 text-xs font-bold uppercase tracking-wider bg-white/50 dark:bg-white/10 hover:bg-brandOrange/20 dark:hover:bg-brandOrange/30 border border-brandOrange/30 text-brandOrange px-4 py-2 rounded-xl transition-all disabled:opacity-50">
                                                        <IconMagic /> {isAutoFilling ? 'KI lädt...' : 'KI Auto-Fill starten'}
                                                    </button>
                                                </div>
                                                
                                                <div className="grid grid-cols-3 gap-6 mb-8 bg-white/40 dark:bg-white/5 p-6 rounded-2xl border border-slate-300/50 dark:border-white/10">
                                                    <div>
                                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/40 uppercase tracking-widest">Aktuelles Modell</label>
                                                        <div className="w-full bg-slate-100/50 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-xl p-3 text-sm text-slate-700 dark:text-white/70 font-medium">{currentProject.title}</div>
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/40 uppercase tracking-widest">Vorgänger</label>
                                                        <input 
                                                            value={currentProject.comparison.predecessor} 
                                                            onChange={(e) => updateCurrentProject({ comparison: { ...currentProject.comparison, predecessor: e.target.value }})}
                                                            className="w-full bg-white/60 dark:bg-black/40 border border-slate-300/50 dark:border-white/20 rounded-xl p-3 text-sm outline-none focus:border-brandOrange shadow-inner" 
                                                            placeholder="z.B. Dreame L10s Ultra" 
                                                        />
                                                    </div>
                                                    <div>
                                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/40 uppercase tracking-widest">Konkurrent</label>
                                                        <input 
                                                            value={currentProject.comparison.competitor} 
                                                            onChange={(e) => updateCurrentProject({ comparison: { ...currentProject.comparison, competitor: e.target.value }})}
                                                            className="w-full bg-white/60 dark:bg-black/40 border border-slate-300/50 dark:border-white/20 rounded-xl p-3 text-sm outline-none focus:border-brandOrange shadow-inner" 
                                                            placeholder="z.B. Roborock S8 Pro" 
                                                        />
                                                    </div>
                                                </div>

                                                <div className="border border-slate-300/50 dark:border-white/10 rounded-2xl overflow-hidden bg-white/40 dark:bg-black/20">
                                                    <table className="w-full text-sm text-left">
                                                        <thead className="text-xs uppercase bg-slate-200/50 dark:bg-white/5 text-slate-600 dark:text-white/60 font-bold tracking-widest">
                                                            <tr>
                                                                <th className="px-6 py-4 w-1/4">Spezifikation</th>
                                                                <th className="px-6 py-4 w-1/4 text-brandOrange">Aktuell</th>
                                                                <th className="px-6 py-4 w-1/4">Vorgänger</th>
                                                                <th className="px-6 py-4 w-1/4">Konkurrent</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody className="divide-y divide-slate-300/50 dark:divide-white/5">
                                                            {currentProject.comparison.specs.map((spec) => (
                                                                <tr key={spec.id} className="hover:bg-white/50 dark:hover:bg-white/5 transition-colors">
                                                                    <td className="px-6 py-3">
                                                                        <input value={spec.key} onChange={(e) => updateSpec(spec.id, 'key', e.target.value)} className="w-full bg-transparent border-none outline-none font-bold text-slate-700 dark:text-white/80" />
                                                                    </td>
                                                                    <td className="px-6 py-3"><input value={spec.current} onChange={(e) => updateSpec(spec.id, 'current', e.target.value)} className="w-full bg-white/80 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-lg px-3 py-2 outline-none focus:border-brandOrange text-brandOrange font-medium" placeholder="Wert..." /></td>
                                                                    <td className="px-6 py-3"><input value={spec.pred} onChange={(e) => updateSpec(spec.id, 'pred', e.target.value)} className="w-full bg-white/80 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-lg px-3 py-2 outline-none focus:border-brandOrange" placeholder="Wert..." /></td>
                                                                    <td className="px-6 py-3"><input value={spec.comp} onChange={(e) => updateSpec(spec.id, 'comp', e.target.value)} className="w-full bg-white/80 dark:bg-black/30 border border-slate-300/50 dark:border-white/10 rounded-lg px-3 py-2 outline-none focus:border-brandOrange" placeholder="Wert..." /></td>
                                                                </tr>
                                                            ))}
                                                        </tbody>
                                                    </table>
                                                </div>
                                                <div className="flex items-center gap-4 mt-6 pt-6 border-t border-slate-300/50 dark:border-white/10">
                                                    <input 
                                                        value={newSpecKey}
                                                        onChange={(e) => setNewSpecKey(e.target.value)}
                                                        onKeyDown={(e) => e.key === 'Enter' && addSpecRow()}
                                                        placeholder="Neue Eigenschaft (z.B. Ladezeit)..."
                                                        className="flex-1 bg-white/60 dark:bg-black/30 border border-slate-300/50 dark:border-white/20 rounded-xl p-4 text-sm outline-none focus:border-cyanAccent shadow-inner"
                                                    />
                                                    <button onClick={addSpecRow} className="bg-white/50 dark:bg-white/10 hover:bg-cyanAccent/20 border border-slate-300/50 dark:border-white/20 hover:border-cyanAccent/50 text-slate-800 dark:text-white px-6 py-4 rounded-xl text-sm font-bold flex items-center gap-2 transition-all">
                                                        <IconPlus /> Eigenschaft anlegen
                                                    </button>
                                                </div>
                                            </div>
                                        )}

                                        {/* TAB: AI EDITOR */}
                                        {activeTab === 'ai' && (
                                            <div className="glass-panel p-8 rounded-3xl shadow-xl dark:shadow-2xl flex flex-col h-[75vh]">
                                                <div className="flex justify-between items-center mb-6">
                                                    <div>
                                                        <h3 className="text-2xl font-bold flex items-center gap-3"><IconZap /> KI Draft Generation</h3>
                                                        <p className="text-sm text-slate-600 dark:text-white/50 mt-1">Die KI nutzt deine Checklisten-Notizen, den Vergleich und die Scorecard.</p>
                                                    </div>
                                                    <button 
                                                        onClick={generateDraft}
                                                        disabled={isGenerating}
                                                        className="bg-gradient-to-r from-brandOrange to-purpleAccent text-white px-8 py-3 rounded-xl font-bold shadow-[0_0_20px_rgba(255,123,0,0.4)] hover:shadow-[0_0_30px_rgba(255,123,0,0.6)] transition-all disabled:opacity-50 flex items-center gap-2 transform hover:scale-105 active:scale-95"
                                                    >
                                                        {isGenerating ? 'Tippt dein Meisterwerk...' : 'Review schreiben lassen'}
                                                    </button>
                                                </div>
                                                
                                                <textarea
                                                    className="flex-1 w-full bg-white/60 dark:bg-black/40 border border-slate-300/50 dark:border-white/10 rounded-2xl p-6 resize-none outline-none focus:border-brandOrange/50 shadow-inner text-slate-800 dark:text-white/90 leading-relaxed text-lg font-serif"
                                                    value={currentProject.aiDraft}
                                                    onChange={(e) => updateCurrentProject({ aiDraft: e.target.value })}
                                                    placeholder="Klicke auf 'Review schreiben lassen'. Dein Meisterwerk erscheint hier... (ohne Gedankenstriche!)"
                                                ></textarea>
                                            </div>
                                        )}

                                    </div>
                                </div>
                            </>
                        ) : (
                            <div className="flex-1 flex flex-col items-center justify-center opacity-40 dark:opacity-30">
                                <BrandLogo />
                                <p className="mt-6 text-xl font-light tracking-wide text-slate-600 dark:text-white">Wähle ein Projekt aus der Sidebar oder erstelle ein neues.</p>
                            </div>
                        )}
                    </main>

                    {/* MODALS */}
                    
                    {/* Settings Modal */}
                    {showSettingsModal && (
                        <div className="fixed inset-0 bg-slate-900/50 dark:bg-black/80 backdrop-blur-xl z-50 flex items-center justify-center p-4">
                            <div className="glass-panel !bg-white/90 dark:!bg-black/50 rounded-3xl p-8 max-w-md w-full shadow-[0_0_50px_rgba(0,0,0,0.2)] dark:shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-white/50 dark:border-white/20">
                                <h3 className="text-2xl font-bold mb-2 text-slate-900 dark:text-white">Einstellungen</h3>
                                <p className="text-sm text-slate-500 dark:text-white/50 mb-6">Hinterlege hier deinen Google Gemini API Key für die Auto-Fill und Review-Funktionen.</p>
                                
                                <div className="space-y-6 mb-8">
                                    <div>
                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/50 uppercase tracking-widest">Gemini API Key</label>
                                        <input 
                                            type="password"
                                            value={apiKey}
                                            onChange={(e) => setApiKey(e.target.value)}
                                            className="w-full bg-white/50 dark:bg-black/50 border border-slate-300/50 dark:border-white/10 rounded-xl p-4 outline-none focus:border-brandOrange text-slate-900 dark:text-white text-lg shadow-inner"
                                            placeholder="AIzaSy..."
                                        />
                                        <p className="text-xs text-slate-400 dark:text-white/40 mt-2">Der Key wird lokal in deinem Browser gespeichert (localStorage).</p>
                                    </div>
                                </div>
                                <div className="flex justify-end gap-4">
                                    <button onClick={() => setShowSettingsModal(false)} className="px-6 py-3 rounded-xl hover:bg-slate-200/50 dark:hover:bg-white/10 transition text-sm font-bold text-slate-600 dark:text-white/60 hover:text-slate-900 dark:hover:text-white">Schließen</button>
                                    <button 
                                        onClick={() => { localStorage.setItem('ttv_apikey', apiKey); setShowSettingsModal(false); }} 
                                        className="bg-brandOrange hover:bg-[#E66E00] text-white px-8 py-3 rounded-xl font-black shadow-[0_0_20px_rgba(255,123,0,0.3)] transition transform hover:scale-105 active:scale-95"
                                    >
                                        Speichern
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Create Project Modal */}
                    {showNewProjectModal && (
                        <div className="fixed inset-0 bg-slate-900/50 dark:bg-black/80 backdrop-blur-xl z-50 flex items-center justify-center p-4">
                            <div className="glass-panel !bg-white/80 dark:!bg-black/50 rounded-3xl p-8 max-w-md w-full shadow-[0_0_50px_rgba(0,0,0,0.2)] dark:shadow-[0_0_50px_rgba(0,0,0,0.8)] border border-white/50 dark:border-white/20">
                                <h3 className="text-2xl font-bold mb-6 text-transparent bg-clip-text bg-gradient-to-r from-brandOrange to-purpleAccent">Neues Projekt anlegen</h3>
                                <div className="space-y-6 mb-8">
                                    <div>
                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/50 uppercase tracking-widest">Produktname</label>
                                        <input 
                                            value={newProjectTitle}
                                            onChange={(e) => setNewProjectTitle(e.target.value)}
                                            autoFocus
                                            className="w-full bg-white/50 dark:bg-black/50 border border-slate-300/50 dark:border-white/10 rounded-xl p-4 outline-none focus:border-brandOrange text-slate-900 dark:text-white text-lg shadow-inner"
                                            placeholder="z.B. Dreame L10s Ultra Gen 3"
                                        />
                                    </div>
                                    <div>
                                        <label className="block text-xs font-bold mb-2 text-slate-500 dark:text-white/50 uppercase tracking-widest">Kategorie</label>
                                        <select 
                                            value={isCreatingCategory ? 'NEW' : newProjectCategory}
                                            onChange={(e) => {
                                                if (e.target.value === 'NEW') {
                                                    setIsCreatingCategory(true);
                                                    setNewProjectCategory('NEW');
                                                } else {
                                                    setIsCreatingCategory(false);
                                                    setNewProjectCategory(e.target.value);
                                                }
                                            }}
                                            className="w-full bg-white/50 dark:bg-black/50 border border-slate-300/50 dark:border-white/10 rounded-xl p-4 outline-none focus:border-brandOrange text-slate-900 dark:text-white text-lg shadow-inner appearance-none cursor-pointer"
                                        >
                                            {categories.map(c => (
                                                <option key={c.id} value={c.id} className="bg-white dark:bg-slate-900 text-slate-900 dark:text-white">{c.name}</option>
                                            ))}
                                            <option value="NEW" className="bg-white dark:bg-slate-900 font-bold text-brandOrange">+ Neue Kategorie anlegen...</option>
                                        </select>
                                    </div>
                                    
                                    {isCreatingCategory && (
                                        <div className="animate-[fade-in_0.3s_ease-out]">
                                            <label className="block text-xs font-bold mb-2 text-brandOrange uppercase tracking-widest">Name der neuen Kategorie</label>
                                            <input 
                                                value={newCustomCategory}
                                                onChange={(e) => setNewCustomCategory(e.target.value)}
                                                className="w-full bg-brandOrange/5 border border-brandOrange/30 rounded-xl p-4 outline-none focus:border-brandOrange text-slate-900 dark:text-white text-lg shadow-inner"
                                                placeholder="z.B. E-Scooter"
                                            />
                                            <p className="text-xs text-slate-500 dark:text-white/40 mt-2">Die Kategorie wird gespeichert und erhält eine Standard-Testvorlage.</p>
                                        </div>
                                    )}
                                </div>
                                <div className="flex justify-end gap-4">
                                    <button onClick={() => {setShowNewProjectModal(false); setIsCreatingCategory(false);}} className="px-6 py-3 rounded-xl hover:bg-slate-200/50 dark:hover:bg-white/10 transition text-sm font-bold text-slate-600 dark:text-white/60 hover:text-slate-900 dark:hover:text-white">Abbrechen</button>
                                    <button onClick={handleCreateProject} className="bg-slate-900 dark:bg-white text-white dark:text-black px-8 py-3 rounded-xl font-black shadow-[0_0_20px_rgba(0,0,0,0.1)] dark:shadow-[0_0_20px_rgba(255,255,255,0.3)] hover:shadow-[0_0_30px_rgba(255,123,0,0.5)] transition transform hover:scale-105 active:scale-95">Erstellen</button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* Delete Confirm Modal */}
                    {projectToDelete && (
                        <div className="fixed inset-0 bg-slate-900/50 dark:bg-black/80 backdrop-blur-xl z-50 flex items-center justify-center p-4">
                            <div className="glass-panel !bg-white/90 dark:!bg-black/50 rounded-3xl p-8 max-w-sm w-full shadow-[0_0_50px_rgba(0,0,0,0.2)] dark:shadow-[0_0_50px_rgba(0,0,0,0.8)] text-center border border-red-500/30">
                                <div className="w-16 h-16 bg-red-100 dark:bg-red-500/20 text-red-500 rounded-2xl flex items-center justify-center mx-auto mb-6 shadow-[0_0_20px_rgba(239,68,68,0.2)] dark:shadow-[0_0_20px_rgba(239,68,68,0.4)]">
                                    <IconTrash />
                                </div>
                                <h3 className="text-xl font-bold mb-3 text-slate-900 dark:text-white">Projekt wirklich löschen?</h3>
                                <p className="text-sm text-slate-600 dark:text-white/50 mb-8">Das kann nicht rückgängig gemacht werden. Alle Daten, Notizen und KI-Texte gehen verloren.</p>
                                <div className="flex justify-center gap-4">
                                    <button onClick={() => setProjectToDelete(null)} className="px-6 py-3 rounded-xl hover:bg-slate-200/50 dark:hover:bg-white/10 transition text-sm font-bold text-slate-600 dark:text-white/60 hover:text-slate-900 dark:hover:text-white">Abbrechen</button>
                                    <button onClick={confirmDeleteProject} className="bg-red-500 hover:bg-red-600 dark:hover:bg-red-400 text-white px-8 py-3 rounded-xl font-black shadow-[0_0_20px_rgba(239,68,68,0.4)] transition transform hover:scale-105 active:scale-95">Ja, löschen</button>
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
